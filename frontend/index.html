<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude 无限畅享版</title>
    <link rel="icon" type="image/svg+xml" href="/frontend/img/claude-color.svg">
    <script>
        // 在页面渲染前设置主题，避免闪烁
        (function() {
            var theme = localStorage.getItem('theme') ||
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <style>[v-cloak] { display: none !important; }</style>
    <link href="/frontend/vendor/css/remixicon.css" rel="stylesheet">

    <!-- Vue 3 -->
    <script src="/frontend/vendor/js/vue.global.js"></script>

    <!-- Markdown & Highlight -->
    <script src="/frontend/vendor/js/marked.min.js"></script>
    <link rel="stylesheet" href="/frontend/vendor/css/github.min.css" id="hljs-light">
    <link rel="stylesheet" href="/frontend/vendor/css/github-dark.min.css" id="hljs-dark" disabled>
    <script src="/frontend/vendor/js/highlight.min.js"></script>

    <!-- 模块化CSS -->
    <link rel="stylesheet" href="/frontend/css/variables.css">
    <link rel="stylesheet" href="/frontend/css/base.css">
    <link rel="stylesheet" href="/frontend/css/components.css">
    <link rel="stylesheet" href="/frontend/css/modals.css">
    <link rel="stylesheet" href="/frontend/css/chat.css">
    <link rel="stylesheet" href="/frontend/css/users.css">
    <link rel="stylesheet" href="/frontend/css/settings.css">
    <link rel="stylesheet" href="/frontend/css/serverLogs.css">
</head>
<body>
    <div id="app" v-cloak :class="{'layout-centered': !settingsData.layoutFullWidth}">
        <!-- ==================== 顶部导航栏 ==================== -->
        <header class="app-header" :class="{'layout-centered': !settingsData.layoutFullWidth}">
            <div class="header-logo">
                <img src="/frontend/img/claude-color-light.svg" alt="Claude" class="header-logo-icon header-logo-icon--light">
                <img src="/frontend/img/claude-color-dark.svg" alt="Claude" class="header-logo-icon header-logo-icon--dark">
                <img src="/frontend/img/claude-text-light.svg" alt="Claude" class="header-logo-text-img header-logo-text-img--light">
                <img src="/frontend/img/claude-text-dark.svg" alt="Claude" class="header-logo-text-img header-logo-text-img--dark">
                <span class="header-logo-subtitle">无限畅享版 <span v-if="appVersion" class="header-version">{{ appVersion }}</span></span>
            </div>
            <div class="header-actions">
                <!-- 激活按钮（免费版显示） -->
                <!-- 版本徽章 -->
                <button :class="editionBadgeClass" @click="handleOpenVersionModal" data-tooltip="点击查看版本详情">
                    <i :class="editionIcon"></i>
                    <span>{{ editionDisplayName }}</span>
                    <span class="edition-quota">{{ accountQuotaText }}</span>
                </button>
                <button class="btn btn--header" @click="handleToggleTheme" data-tooltip="切换主题">
                    <i :class="theme === 'dark' ? 'ri-sun-line' : 'ri-moon-line'"></i>
                </button>
                <button class="btn btn--header" @click="handleLogout" data-tooltip="退出登录">
                    <i class="ri-logout-box-r-line"></i> 退出
                </button>
            </div>
        </header>

        <!-- ==================== 公告跑马灯 ==================== -->
        <!-- 系统公告（优先展示） -->
        <div class="announcement-bar" v-if="settingsData.announcementEnabled && !announcementClosed">
            <div class="announcement-content">
                <div class="announcement-marquee">
                    <span class="announcement-text">{{ settingsData.announcementText }}</span>
                    <span class="announcement-text">{{ settingsData.announcementText }}</span>
                    <span class="announcement-text">{{ settingsData.announcementText }}</span>
                </div>
            </div>
            <button class="announcement-close" @click="announcementClosed = true" data-tooltip="关闭公告">
                <i class="ri-close-line"></i>
            </button>
        </div>
        <!-- 远程公告（本地公告未启用时展示） -->
        <div class="announcement-bar announcement-bar--remote" v-else-if="settingsData.remoteAnnouncement && !remoteAnnouncementClosed">
            <div class="announcement-content">
                <div class="announcement-marquee">
                    <span class="announcement-text">{{ settingsData.remoteAnnouncement }}</span>
                    <span class="announcement-text">{{ settingsData.remoteAnnouncement }}</span>
                    <span class="announcement-text">{{ settingsData.remoteAnnouncement }}</span>
                </div>
            </div>
            <button class="announcement-close" @click="remoteAnnouncementClosed = true" data-tooltip="关闭公告">
                <i class="ri-close-line"></i>
            </button>
        </div>

        <!-- ==================== Tab 导航 ==================== -->
        <nav class="tab-navigation" :class="{'layout-centered': !settingsData.layoutFullWidth, 'has-announcement': (settingsData.remoteAnnouncement && !remoteAnnouncementClosed) || (settingsData.announcementEnabled && !announcementClosed)}">
            <div class="tab-nav-inner" :class="{'layout-centered': !settingsData.layoutFullWidth}">
                <button
                    v-for="tab in tabs.filter(t => t.id !== 'logs' || settingsData.enableRequestLog)"
                    :key="tab.id"
                    class="tab-nav-button"
                    :class="{'is-active': activeTab === tab.id}"
                    @click="handleTabChange(tab.id)">
                    {{ tab.label }}
                </button>
            </div>
        </nav>

        <!-- ==================== 主内容区 ==================== -->
        <main class="app-content" :class="{'layout-centered': !settingsData.layoutFullWidth}">
            <!-- Tab 面板: 首页欢迎 -->
            <section class="tab-panel home-panel" :class="{'is-active': activeTab === 'home'}">
                <div class="welcome-hero">
                    <div class="welcome-hero-text">
                        <div class="welcome-badge">
                            <i class="ri-sparkling-2-line"></i> 欢迎使用 Claude 无限畅享版控制台
                        </div>
                        <h2>一站式账号、日志与配额管理</h2>
                        <p>在这里快速配置账号、查看请求日志、管理用户与 IP，遵循最佳实践即可稳定运行。右侧提供快捷指引，帮助你快速上手。</p>
                        <div class="welcome-hero-actions">
                            <button class="btn btn--primary" @click="handleTabChange('accounts')">
                                <i class="btn-icon ri-settings-3-line"></i> 开始配置账号
                            </button>
                            <button class="btn btn--secondary" @click="handleTabChange('logs')">
                                <i class="btn-icon ri-bar-chart-box-line"></i> 查看请求日志
                            </button>
                            <button class="btn btn--secondary" @click="handleTabChange('settings')">
                                <i class="btn-icon ri-shield-keyhole-line"></i> 系统配置
                            </button>
                        </div>
                        <div class="welcome-doc-links">
                            <a href="https://ai.feishu.cn/wiki/NCkew5ltsi1mkPk7p9XcxrT2naf" target="_blank" class="welcome-doc-link">
                                <i class="ri-book-open-line"></i> 使用文档
                            </a>
                            <a href="https://ai.feishu.cn/wiki/BI45wfSvFiLFHLkzAlicRs41nnz" target="_blank" class="welcome-doc-link welcome-doc-link--video">
                                <i class="ri-video-line"></i> 视频教程
                            </a>
                            <a href="https://ai.feishu.cn/wiki/RRNtw1AtFi2g4vk2rNPc0EeYnKF" target="_blank" class="welcome-doc-link welcome-doc-link--outline">
                                <i class="ri-global-line"></i> 公网配置
                            </a>
                        </div>
                        <div class="welcome-quick-stats">
                            <div class="welcome-pill"><i class="ri-shield-check-line"></i> 开启防滥用：IP频率限制 & 请求日志</div>
                            <div class="welcome-pill"><i class="ri-time-line"></i> 建议每天导出备份，避免数据丢失</div>
                        </div>
                    </div>
                    <div class="welcome-hero-side">
                        <div class="welcome-side-card">
                            <div class="welcome-side-header">
                                <i class="ri-compass-3-line"></i>
                                快速导航
                            </div>
                            <ul class="welcome-side-links">
                                <li @click="handleTabChange('accounts')"><i class="ri-key-2-line"></i> 账号管理：添加 / 刷新 Token / 导入导出</li>
                                <li @click="handleTabChange('logs')"><i class="ri-line-chart-line"></i> 请求日志：筛选、统计、错误排查</li>
                                <li @click="handleTabChange('users')"><i class="ri-team-line"></i> 用户管理：配额与 Token 统计</li>
                                <li @click="handleTabChange('ips')"><i class="ri-shield-star-line"></i> IP 管控：限频与封禁</li>
                                <li @click="handleTabChange('settings')"><i class="ri-tools-line"></i> 系统配置：开关日志、备份导入导出</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="welcome-grid">
                    <!-- 版本信息卡片 -->
                    <div class="welcome-card welcome-card--version">
                        <div class="welcome-card-header">
                            <i :class="editionIcon"></i>
                            版本信息
                        </div>
                        <div class="version-card-content">
                            <div class="version-card-badge" @click="handleOpenVersionModal" style="cursor:pointer;">
                                <span :class="editionBadgeClass + ' large'">
                                    <i :class="editionIcon"></i>
                                    {{ editionDisplayName }}
                                </span>
                            </div>
                            <div class="version-card-quota">
                                <div class="version-card-quota-header">
                                    <span>账号配额</span>
                                    <span :class="{'text-warning': isNearQuotaLimit, 'text-danger': isAtQuotaLimit}">{{ accountQuotaText }}</span>
                                </div>
                                <div class="version-quota-bar">
                                    <div class="version-quota-fill" :style="{width: accountQuotaPercent + '%'}" :class="{'near-limit': isNearQuotaLimit, 'at-limit': isAtQuotaLimit}"></div>
                                </div>
                                <p class="version-card-hint" v-if="!isAtQuotaLimit">
                                    还可添加 <strong>{{ remainingAccountQuota }}</strong> 个账号
                                </p>
                                <p class="version-card-hint text-danger" v-else>
                                    <i class="ri-error-warning-line"></i> 已达账号上限，无法继续添加
                                </p>
                            </div>
                            <p class="version-card-note">
                                <i class="ri-information-line"></i> 配额仅限制同时存在的账号数量，可删除旧账号后添加新账号，无使用次数限制
                            </p>
                            <p class="version-card-note">
                                <i class="ri-device-line"></i> 一个激活码只能激活一台设备，第二台设备半价
                            </p>
                            <div class="version-card-upgrade" v-if="settingsData.edition !== 'ultra'">
                                <button class="btn btn--outline btn--small" @click="handleOpenVersionModal">
                                    <i class="ri-rocket-line"></i> 查看升级方案
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-road-map-line"></i>
                            使用步骤
                        </div>
                        <ol class="welcome-steps">
                            <li>在「账号管理」添加账号（支持批量导入），确保 Token 刷新正常。</li>
                            <li>在「系统配置」打开请求日志与 IP 频率限制，设置保留天数。</li>
                            <li>在「请求日志」按时间、IP、账号筛选，查看统计卡片与错误详情。</li>
                            <li>在「用户管理」分配配额、查看 Token 消耗与成功率。</li>
                            <li>定期导出备份（账号 + 配置 + 日志），必要时一键导入恢复。</li>
                        </ol>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-thumb-up-line"></i>
                            最佳实践
                        </div>
                        <ul class="welcome-list">
                            <li><i class="ri-check-line"></i> 启用请求日志与统计，排查问题更高效。</li>
                            <li><i class="ri-check-line"></i> 为不同用户设置配额，避免资源争用。</li>
                            <li><i class="ri-check-line"></i> 配置 IP 限频，防止恶意刷接口。</li>
                            <li><i class="ri-check-line"></i> 重要操作后导出备份，降低数据风险。</li>
                            <li><i class="ri-check-line"></i> 遇到错误先看日志详情与统计，再定位账号或 IP。</li>
                        </ul>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-robot-line"></i>
                            支持的模型
                        </div>
                        <ul class="welcome-list">
                            <li><i class="ri-checkbox-circle-line"></i> <code>claude-opus-4.5</code> - 最强推理能力</li>
                            <li><i class="ri-checkbox-circle-line"></i> <code>claude-opus-4.5-think</code> - 最强推理+深度思考</li>
                            <li><i class="ri-checkbox-circle-line"></i> <code>claude-sonnet-4.5</code> - 平衡性能与速度</li>
                            <li><i class="ri-checkbox-circle-line"></i> <code>claude-sonnet-4.5-think</code> - 平衡性能+深度思考</li>
                            <li><i class="ri-checkbox-circle-line"></i> <code>claude-haiku-4.5</code> - 轻量高效</li>
                            <li><i class="ri-checkbox-circle-line"></i> <code>auto</code> - 自动选择最佳模型</li>
                        </ul>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-terminal-box-line"></i>
                            Claude Code 配置
                        </div>
                        <ul class="welcome-list">
                            <li><i class="ri-terminal-line"></i> 设置环境变量:</li>
                        </ul>
                        <pre class="welcome-code"><code>export ANTHROPIC_BASE_URL=http://你的服务器地址:端口
export ANTHROPIC_API_KEY=你的API密钥</code></pre>
                        <ul class="welcome-list" style="margin-top: 8px;">
                            <li><i class="ri-information-line"></i> 配置后重启终端生效</li>
                            <li><i class="ri-book-open-line"></i> <a href="https://docs.anthropic.com/zh-CN/docs/claude-code/overview" target="_blank" style="color: var(--color-accent-primary);">官方文档 →</a></li>
                        </ul>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-cursor-line"></i>
                            Cursor 配置
                        </div>
                        <div class="welcome-notice" style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 6px; padding: 10px 12px; margin-bottom: 12px;">
                            <p style="margin: 0 0 6px 0; color: #f59e0b; font-weight: 500; font-size: 12px;"><i class="ri-error-warning-line" style="margin-right: 4px;"></i>重要说明</p>
                            <ul style="margin: 0; padding-left: 16px; font-size: 12px; color: var(--color-text-secondary); line-height: 1.6;">
                                <li>仅 <strong style="color: var(--color-text-primary);">Cursor Pro Plan</strong> 用户支持配置第三方 API</li>
                                <li>需要配置<strong style="color: var(--color-text-primary);">公网域名</strong>才可使用，公网配置请查看<a href="https://ai.feishu.cn/wiki/RRNtw1AtFi2g4vk2rNPc0EeYnKF" target="_blank" style="color: #3b82f6; text-decoration: none; margin-left: 4px;">部署文档</a></li>
                            </ul>
                        </div>
                        <ul class="welcome-list">
                            <li><i class="ri-settings-3-line"></i> 打开 Cursor Settings → Models</li>
                            <li><i class="ri-add-circle-line"></i> 点击 "Add Model" 添加模型</li>
                            <li><i class="ri-links-line"></i> Override OpenAI Base URL:</li>
                        </ul>
                        <pre class="welcome-code"><code>https://你的公网域名/v1</code></pre>
                        <ul class="welcome-list" style="margin-top: 8px;">
                            <li><i class="ri-key-line"></i> API Key 填写你的密钥</li>
                        </ul>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-flashlight-line"></i>
                            常用快捷操作
                        </div>
                        <div class="welcome-actions">
                            <button class="btn btn--secondary" @click="handleTabChange('accounts')"><i class="btn-icon ri-refresh-line"></i> 刷新账号状态</button>
                            <button class="btn btn--secondary" @click="handleTabChange('logs')"><i class="btn-icon ri-search-eye-line"></i> 查看最近 24h 日志</button>
                            <button class="btn btn--secondary" @click="handleTabChange('settings')"><i class="btn-icon ri-delete-bin-6-line"></i> 配置日志保留/清理</button>
                            <button class="btn btn--secondary" @click="handleTabChange('ips')"><i class="btn-icon ri-shield-line"></i> 设置 IP 限频</button>
                        </div>
                    </div>

                    <div class="welcome-card">
                        <div class="welcome-card-header">
                            <i class="ri-lightbulb-flash-line"></i>
                            问题排查提示
                        </div>
                        <ul class="welcome-list">
                            <li><i class="ri-bug-line"></i> 接口失败：查看请求日志错误信息与耗时，关注状态码。</li>
                            <li><i class="ri-speed-up-line"></i> 延迟升高：检查平均耗时、是否触发限频或账号异常。</li>
                            <li><i class="ri-shield-keyhole-line"></i> 异常流量：按 IP/账号过滤日志，开启更严格的限频。</li>
                            <li><i class="ri-database-2-line"></i> 数据安全：定期备份，导入前确认覆盖范围。</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Tab 面板: 账号管理 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'accounts'}">
                <div class="page-header">
                    <h2 class="page-header-title">
                        账号管理
                    </h2>
                    <div class="page-header-actions">
                        <!-- 状态筛选下拉框 -->
                        <div class="custom-select custom-select--compact" :class="{ 'is-open': accountStatusSelectOpen }" style="min-width: 100px;">
                            <div class="custom-select-trigger" @click="accountStatusSelectOpen = !accountStatusSelectOpen">
                                <span>{{ getStatusFilterLabel(accountStatusFilter) }}</span>
                                <i class="ri-arrow-down-s-line"></i>
                            </div>
                            <div class="custom-select-options" v-show="accountStatusSelectOpen">
                                <div v-for="status in supportedAccountStatuses"
                                     :key="status.value"
                                     class="custom-select-option"
                                     :class="{ 'is-selected': accountStatusFilter === status.value }"
                                     @click="setAccountStatusFilter(status.value); accountStatusSelectOpen = false;">
                                    {{ status.label }}
                                </div>
                            </div>
                        </div>
                        <!-- 视图切换按钮 -->
                        <button class="view-toggle-btn" @click="toggleAccountViewMode" :data-tooltip="accountViewMode === 'table' ? '切换到卡片视图' : '切换到表格视图'">
                            <i :class="accountViewMode === 'table' ? 'ri-table-line' : 'ri-layout-grid-line'"></i>
                        </button>
                        <button class="btn btn--secondary" @click="handleEnableAllAccounts" :disabled="isTogglingAll" data-tooltip="启用所有账号（不包括封控账号）">
                            <i class="btn-icon ri-checkbox-circle-line" :class="{'is-spinning': isTogglingAll}"></i> 启用所有
                        </button>
                        <button class="btn btn--secondary" @click="handleDisableAllAccounts" :disabled="isTogglingAll" data-tooltip="禁用所有账号">
                            <i class="btn-icon ri-close-circle-line" :class="{'is-spinning': isTogglingAll}"></i> 禁用所有
                        </button>
                        <button class="btn btn--secondary" @click="handleDeleteSuspendedAccounts" :disabled="isDeletingSuspended" data-tooltip="删除所有被封控的账号">
                            <i class="btn-icon ri-shield-cross-line" :class="{'is-spinning': isDeletingSuspended}" style="color: var(--color-danger);"></i> 删除封控
                        </button>
                        <!-- 删除无效账号按钮已隐藏 -->
                        <!-- <button class="btn btn--secondary" @click="handleDeleteIncompleteAccounts" :disabled="isCheckingIncomplete" data-tooltip="删除所有信息不全的账号（缺少 clientId 或 clientSecret）">
                            <i class="btn-icon ri-delete-bin-line" :class="{'is-spinning': isCheckingIncomplete}"></i> 删除无效账号
                        </button> -->
                        <button class="btn btn--secondary" @click="handleExportAccounts">
                            <i class="btn-icon ri-download-line"></i> 导出
                        </button>
                        <button class="btn btn--secondary" @click="handleImportAccounts">
                            <i class="btn-icon ri-upload-line"></i> 导入
                        </button>
                        <input type="file" ref="accountImportInput" accept=".json" style="display:none" @change="handleAccountImportFileChange">
                        <button class="btn btn--secondary" @click="handleImportByToken" data-tooltip="通过 refreshToken 批量导入账号（支持完整 IdC 格式）">
                            <i class="btn-icon ri-key-2-line"></i> Token 导入
                        </button>
                        <input type="file" ref="tokenImportInput" accept=".json" style="display:none" @change="handleTokenImportFileChange">
                        <button class="btn btn--secondary" @click="handleRefreshAllQuotas" :disabled="isRefreshingQuotas" data-tooltip="刷新所有启用账号的配额信息">
                            <i class="btn-icon ri-pie-chart-line" :class="{'is-spinning': isRefreshingQuotas}"></i> 刷新配额
                        </button>
                        <button class="btn btn--secondary" @click="handleRefreshAllAccounts" :disabled="isRefreshingAll" data-tooltip="刷新所有启用账号的 Token 并重新加载列表">
                            <i class="btn-icon ri-refresh-line" :class="{'is-spinning': isRefreshingAll}"></i> 刷新
                        </button>
                        <button class="btn btn--primary" @click="handleStartOAuth">
                            <i class="btn-icon ri-add-line"></i> 添加账号
                        </button>
                    </div>
                </div>

                <!-- 账号统计面板 -->
                <div class="account-stats-panel" v-if="accounts.length > 0">
                    <div class="account-stats-grid">
                        <!-- 账号数量 -->
                        <div class="account-stat-item">
                            <div class="account-stat-icon account-stat-icon--accounts">
                                <i class="ri-user-line"></i>
                            </div>
                            <div class="account-stat-content">
                                <div class="account-stat-label">账号数量</div>
                                                <div class="account-stat-value">
                                                    <span class="account-stat-highlight">{{ formatNumber(accountsEnabledCount) }}</span>
                                                    <span class="account-stat-divider">/</span>
                                                    <span class="account-stat-total" :data-tooltip="'总账号: ' + accountsTotalCount + ' | 封控: ' + accountsSuspendedCount">{{ formatNumber(accountsTotalCount) }}</span>
                                                    <span v-if="accountsSuspendedCount > 0" class="badge badge--danger" style="margin-left: 6px; font-size: 11px;">
                                                        <i class="ri-lock-line"></i> {{ accountsSuspendedCount }}
                                                    </span>
                                                </div>
                            </div>
                        </div>
                        <!-- 成功请求 -->
                        <div class="account-stat-item">
                            <div class="account-stat-icon account-stat-icon--success">
                                <i class="ri-check-double-line"></i>
                            </div>
                            <div class="account-stat-content">
                                <div class="account-stat-label">成功请求</div>
                                <div class="account-stat-value">
                                    <span class="account-stat-highlight account-stat-highlight--success" :data-tooltip="'成功: ' + accountsSuccessTotal">{{ formatNumber(accountsSuccessTotal) }}</span>
                                </div>
                            </div>
                        </div>
                        <!-- 失败请求 -->
                        <div class="account-stat-item">
                            <div class="account-stat-icon account-stat-icon--error">
                                <i class="ri-close-line"></i>
                            </div>
                            <div class="account-stat-content">
                                <div class="account-stat-label">失败请求</div>
                                <div class="account-stat-value">
                                    <span class="account-stat-highlight account-stat-highlight--error" :data-tooltip="'失败: ' + accountsErrorTotal">{{ formatNumber(accountsErrorTotal) }}</span>
                                </div>
                            </div>
                        </div>
                        <!-- 成功率 -->
                        <div class="account-stat-item">
                            <div class="account-stat-icon account-stat-icon--rate">
                                <i class="ri-percent-line"></i>
                            </div>
                            <div class="account-stat-content">
                                <div class="account-stat-label">成功率</div>
                                <div class="account-stat-value">
                                    <span class="account-stat-highlight" :class="{'account-stat-highlight--success': parseFloat(accountsSuccessRate) >= 90, 'account-stat-highlight--warning': parseFloat(accountsSuccessRate) >= 70 && parseFloat(accountsSuccessRate) < 90, 'account-stat-highlight--error': parseFloat(accountsSuccessRate) < 70}">{{ accountsSuccessRate }}%</span>
                                </div>
                            </div>
                        </div>
                        <!-- 总配额使用 -->
                        <div class="account-stat-item account-stat-item--quota">
                            <div class="account-stat-icon account-stat-icon--quota">
                                <i class="ri-pie-chart-line"></i>
                            </div>
                            <div class="account-stat-content account-stat-content--quota">
                                <div class="account-stat-label">总配额使用</div>
                                <div class="account-stat-quota-bar">
                                    <div class="account-stat-quota-fill" :style="{width: (totalQuotaStats.loadedCount > 0 ? totalQuotaStats.percent : 0) + '%'}" :class="{'near-limit': totalQuotaStats.percent >= 70 && totalQuotaStats.percent < 90, 'at-limit': totalQuotaStats.percent >= 90}"></div>
                                </div>
                                <div class="account-stat-quota-detail" v-if="totalQuotaStats.loadedCount > 0" style="font-size: 11px; color: var(--color-text-secondary); margin-top: 2px;">
                                    {{ Math.round(totalQuotaStats.totalUsage) }} / {{ Math.round(totalQuotaStats.totalLimit) }}
                                </div>
                            </div>
                            <div class="account-stat-quota-percent" :class="{'near-limit': totalQuotaStats.percent >= 70 && totalQuotaStats.percent < 90, 'at-limit': totalQuotaStats.percent >= 90}">
                                {{ totalQuotaStats.loadedCount > 0 ? totalQuotaStats.percent.toFixed(2) + '%' : '--' }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 账号表格视图 -->
                <div class="table-container account-table-container" v-if="accounts.length > 0 && accountViewMode === 'table'">
                    <table class="data-table account-table">
                        <thead>
                            <tr>
                                <th class="col-checkbox">
                                    <input type="checkbox"
                                           :checked="isAllAccountsSelected"
                                           @change="toggleSelectAllAccounts">
                                </th>
                                <th class="col-id">ID</th>
                                <th class="col-label">标签</th>
                                <th class="col-email">邮箱</th>
                                <th class="col-status sortable" @click="sortAccountsBy('status')" :class="{'sort-active': accountSortField === 'status'}">
                                    状态
                                    <i class="sort-icon" :class="accountSortField === 'status' ? (accountSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line') : 'ri-arrow-up-down-line'"></i>
                                </th>
                                <th class="col-success sortable" @click="sortAccountsBy('success')" :class="{'sort-active': accountSortField === 'success'}">
                                    成功
                                    <i class="sort-icon" :class="accountSortField === 'success' ? (accountSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line') : 'ri-arrow-up-down-line'"></i>
                                </th>
                                <th class="col-error sortable" @click="sortAccountsBy('error')" :class="{'sort-active': accountSortField === 'error'}">
                                    失败
                                    <i class="sort-icon" :class="accountSortField === 'error' ? (accountSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line') : 'ri-arrow-up-down-line'"></i>
                                </th>
                                <th class="col-quota sortable" @click="sortAccountsBy('quota')" :class="{'sort-active': accountSortField === 'quota'}">
                                    配额
                                    <i class="sort-icon" :class="accountSortField === 'quota' ? (accountSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line') : 'ri-arrow-up-down-line'"></i>
                                </th>
                                <th class="col-expiry">有效时间</th>
                                <th class="col-created sortable" @click="sortAccountsBy('created')" :class="{'sort-active': accountSortField === 'created'}">
                                    创建时间
                                    <i class="sort-icon" :class="accountSortField === 'created' ? (accountSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line') : 'ri-arrow-up-down-line'"></i>
                                </th>
                                <th class="col-actions">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="account in sortedAccounts"
                                :key="account.id"
                                :class="{
                                    'row--enabled': account.enabled,
                                    'row--disabled': !account.enabled,
                                    'row--suspended': isAccountSuspended(account.id),
                                    'row--duplicate': isAccountDuplicate(account.id),
                                    'row--selected': selectedAccountIds.includes(account.id)
                                }">
                                <td class="col-checkbox">
                                    <input type="checkbox"
                                           :checked="selectedAccountIds.includes(account.id)"
                                           @change="toggleSelectAccount(account.id)">
                                </td>
                                <td class="col-id">
                                    <span class="account-id-badge">#{{ getAccountShortId(account.id) }}</span>
                                </td>
                                <td class="col-label">
                                    <span class="label-text" :title="account.label">
                                        {{ maskEmail(account.label) || '-' }}
                                    </span>
                                </td>
                                <td class="col-email">
                                    <span class="email-text" :title="account.email">
                                        {{ maskEmail(account.email) || '-' }}
                                    </span>
                                </td>
                                <td class="col-status">
                                    <span class="status-badge"
                                          :class="{
                                              'status-badge--enabled': account.enabled && !isAccountSuspended(account.id) && !isAccountExhausted(account.id),
                                              'status-badge--disabled': !account.enabled && !isAccountSuspended(account.id) && !isAccountExhausted(account.id),
                                              'status-badge--suspended': isAccountSuspended(account.id),
                                              'status-badge--exhausted': isAccountExhausted(account.id)
                                          }">
                                        {{ isAccountSuspended(account.id) ? '封控' : (isAccountExhausted(account.id) ? '已用尽' : (account.enabled ? '启用' : '禁用')) }}
                                    </span>
                                </td>
                                <td class="col-success">
                                    <span class="count-badge count-badge--success">{{ account.success_count || 0 }}</span>
                                </td>
                                <td class="col-error">
                                    <span class="count-badge count-badge--error">{{ account.error_count || 0 }}</span>
                                </td>
                                <td class="col-quota" @click="loadSingleAccountQuota(account.id, 0, true)"
                                    :data-tooltip="getQuotaTooltip(account.id)">
                                    <div class="quota-cell">
                                        <div class="quota-bar-mini">
                                            <div class="quota-bar-fill"
                                                 :style="{width: getQuotaPercent(account.id) + '%', background: getQuotaColor(account.id)}">
                                            </div>
                                        </div>
                                        <span class="quota-text">{{ getQuotaDisplay(account.id) }}</span>
                                    </div>
                                </td>
                                <td class="col-expiry">
                                    <span class="expiry-text"
                                          :class="{
                                              'expiry-text--warning': isAccountExpiringSoon(account.id),
                                              'expiry-text--expired': isAccountExpired(account.id)
                                          }">
                                        {{ getQuotaResetLabel(account.id) }}
                                    </span>
                                </td>
                                <td class="col-created">
                                    <span class="created-text">{{ formatCreatedTime(account.created_at) }}</span>
                                </td>
                                <td class="col-actions">
                                    <div class="action-buttons">
                                        <button class="btn btn--mini" @click="handleRefreshAccount(account.id)" data-tooltip="刷新Token">
                                            <i class="ri-refresh-line"></i>
                                        </button>
                                        <button class="btn btn--mini" @click="handleToggleAccount(account.id, !account.enabled)"
                                                :data-tooltip="account.enabled ? '禁用账号' : '启用账号'">
                                            <i :class="account.enabled ? 'ri-pause-circle-line' : 'ri-play-circle-line'"></i>
                                        </button>
                                        <button class="btn btn--mini" v-if="settingsData.enableRequestLog"
                                                @click="handleViewLogs(account.id)" data-tooltip="查看日志">
                                            <i class="ri-file-list-line"></i>
                                        </button>
                                        <button class="btn btn--mini btn--danger" @click="handleDeleteAccount(account.id)" data-tooltip="删除账号">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 账号分页（表格视图） @author ygw -->
                <div class="pagination-bar" v-if="accountPagination.pages > 1 && accountViewMode === 'table'">
                    <span class="pagination-info">
                        共 {{ accountPagination.total }} 条，第 <strong>{{ accountPagination.page }}</strong>/{{ accountPagination.pages }} 页
                    </span>
                    <div class="pagination-buttons">
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsGoToPage(1)" :disabled="accountPagination.page <= 1 || isLoadingAccounts" data-tooltip="首页">
                            <i class="ri-skip-back-mini-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsPrevPage" :disabled="accountPagination.page <= 1 || isLoadingAccounts" data-tooltip="上一页">
                            <i class="ri-arrow-left-s-line"></i>
                        </button>
                        <button v-for="page in getAccountsPageNumbers()" :key="page"
                                class="btn btn--sm pagination-btn"
                                :class="page === accountPagination.page ? 'btn--primary' : 'btn--secondary'"
                                @click="handleAccountsGoToPage(page)" :disabled="isLoadingAccounts">
                            {{ page }}
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsNextPage" :disabled="accountPagination.page >= accountPagination.pages || isLoadingAccounts" data-tooltip="下一页">
                            <i class="ri-arrow-right-s-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsGoToPage(accountPagination.pages)" :disabled="accountPagination.page >= accountPagination.pages || isLoadingAccounts" data-tooltip="末页">
                            <i class="ri-skip-forward-mini-line"></i>
                        </button>
                    </div>
                    <div class="pagination-jump">
                        <input type="number" v-model="accountPageJump" @keyup.enter="handleAccountsJumpToPage"
                               placeholder="页码" min="1" :max="accountPagination.pages" class="pagination-input">
                        <button class="btn btn--sm btn--secondary" @click="handleAccountsJumpToPage" :disabled="isLoadingAccounts">
                            跳转
                        </button>
                    </div>
                </div>

                <!-- 批量操作栏 -->
                <div class="batch-action-bar" v-if="selectedAccountIds.length > 0">
                    <span class="batch-action-count">已选择 {{ selectedAccountIds.length }} 个账号</span>
                    <div class="batch-action-buttons">
                        <button class="btn btn--small btn--secondary" @click="handleBatchEnable">批量启用</button>
                        <button class="btn btn--small btn--secondary" @click="handleBatchDisable">批量禁用</button>
                        <button class="btn btn--small btn--danger" @click="handleBatchDelete">批量删除</button>
                        <button class="btn btn--small" @click="clearSelectedAccounts">取消选择</button>
                    </div>
                </div>

                <!-- 账号卡片视图 -->
                <div class="account-grid" v-if="accounts.length > 0 && accountViewMode === 'card'">
                    <article
                        v-for="account in accounts"
                        :key="account.id"
                        class="account-card"
                        :class="{'account-card--enabled': account.enabled, 'account-card--disabled': !account.enabled, 'account-card--duplicate': isAccountDuplicate(account.id), 'account-card--suspended': isAccountSuspended(account.id), 'account-card--exhausted': isAccountExhausted(account.id)}">

                        <div class="account-card-header">
                            <span class="account-card-id">#{{ getAccountShortId(account.id) }}</span>
                            <span class="account-card-status" :class="{'account-card-status--enabled': account.enabled, 'account-card-status--disabled': !account.enabled, 'account-card-status--suspended': isAccountSuspended(account.id), 'account-card-status--exhausted': isAccountExhausted(account.id)}">
                                {{ isAccountSuspended(account.id) ? '⚠ 封控' : (isAccountExhausted(account.id) ? '⚠ 已用尽' : (account.enabled ? '✓ 启用' : '✕ 禁用')) }}
                            </span>
                        </div>

                        <div class="account-card-label-wrapper" :data-tooltip="account.label">
                            <i class="ri-price-tag-3-line"></i>
                            <span class="account-card-label">{{ maskEmail(account.label) || '无备注' }}</span>
                        </div>

                        <div class="account-card-stats">
                            <div class="account-stat account-stat--success">
                                <div class="account-stat-value">{{ account.success_count || 0 }}</div>
                                <div class="account-stat-label">成功</div>
                            </div>
                            <div class="account-stat account-stat--error">
                                <div class="account-stat-value">{{ account.error_count || 0 }}</div>
                                <div class="account-stat-label">失败</div>
                            </div>
                            <div class="account-stat account-stat--quota" @click="loadSingleAccountQuota(account.id, 0, true)">
                                <div class="quota-water" v-if="!isAccountSuspended(account.id)">
                                    <div class="quota-water-fill" :style="{height: getQuotaPercent(account.id) + '%', background: getQuotaColor(account.id)}"></div>
                                    <span class="quota-water-text" :class="{'quota-water-text--exhausted': isAccountExhausted(account.id)}">{{ getQuotaDisplay(account.id) }}</span>
                                </div>
                                <span v-else class="account-stat-value account-stat-value--suspended">封控</span>
                                <div class="account-stat-label">使用量</div>
                                <div class="quota-tooltip" v-if="accountQuotas[account.id] && !accountQuotas[account.id].loading && !accountQuotas[account.id].error && !isAccountSuspended(account.id)">
                                    <span class="quota-tooltip-used" :style="{color: getQuotaColor(account.id)}">{{ accountQuotas[account.id].currentUsage || 0 }}</span>
                                    <span class="quota-tooltip-sep">/</span>
                                    <span class="quota-tooltip-total">{{ accountQuotas[account.id].usageLimit || 0 }}</span>
                                </div>
                                <div class="quota-tooltip" v-else-if="!isAccountSuspended(account.id)">点击刷新</div>
                            </div>
                        </div>

                        <div class="account-card-reset"
                             :class="{
                                 'account-card-reset--warning': isAccountExpiringSoon(account.id),
                                 'account-card-reset--expired': isAccountExpired(account.id)
                             }">
                            <i class="ri-calendar-check-line"></i> {{ getQuotaResetLabel(account.id) }}
                        </div>

                        <div class="account-card-actions">
                            <button class="btn btn--card" @click="handleRefreshAccount(account.id)">刷新</button>
                            <button class="btn btn--card" @click="handleToggleAccount(account.id, !account.enabled)">
                                {{ account.enabled ? '禁用' : '启用' }}
                            </button>
                            <button class="btn btn--card" v-if="settingsData.enableRequestLog" @click="handleViewLogs(account.id)">日志</button>
                            <button class="btn btn--card btn--danger" @click="handleDeleteAccount(account.id)">删除</button>
                        </div>
                    </article>
                </div>

                <!-- 账号分页（卡片视图） @author ygw -->
                <div class="pagination-bar" v-if="accountPagination.pages > 1 && accountViewMode === 'card'">
                    <span class="pagination-info">
                        共 {{ accountPagination.total }} 条，第 <strong>{{ accountPagination.page }}</strong>/{{ accountPagination.pages }} 页
                    </span>
                    <div class="pagination-buttons">
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsGoToPage(1)" :disabled="accountPagination.page <= 1 || isLoadingAccounts" data-tooltip="首页">
                            <i class="ri-skip-back-mini-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsPrevPage" :disabled="accountPagination.page <= 1 || isLoadingAccounts" data-tooltip="上一页">
                            <i class="ri-arrow-left-s-line"></i>
                        </button>
                        <button v-for="page in getAccountsPageNumbers()" :key="page"
                                class="btn btn--sm pagination-btn"
                                :class="page === accountPagination.page ? 'btn--primary' : 'btn--secondary'"
                                @click="handleAccountsGoToPage(page)" :disabled="isLoadingAccounts">
                            {{ page }}
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsNextPage" :disabled="accountPagination.page >= accountPagination.pages || isLoadingAccounts" data-tooltip="下一页">
                            <i class="ri-arrow-right-s-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleAccountsGoToPage(accountPagination.pages)" :disabled="accountPagination.page >= accountPagination.pages || isLoadingAccounts" data-tooltip="末页">
                            <i class="ri-skip-forward-mini-line"></i>
                        </button>
                    </div>
                    <div class="pagination-jump">
                        <input type="number" v-model="accountPageJump" @keyup.enter="handleAccountsJumpToPage"
                               placeholder="页码" min="1" :max="accountPagination.pages" class="pagination-input">
                        <button class="btn btn--sm btn--secondary" @click="handleAccountsJumpToPage" :disabled="isLoadingAccounts">
                            跳转
                        </button>
                    </div>
                </div>

                <!-- 空状态 -->
                <div class="empty-state" v-if="accounts.length === 0">
                    <i class="empty-state-icon ri-inbox-line"></i>
                    <p>暂无账号，点击右上角添加</p>
                </div>
            </section>

            <!-- Tab 面板: 用户管理 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'users'}">
                <!-- 基础版提示 -->
                <div class="empty-state" v-if="settingsData.edition === 'basic'">
                    <i class="empty-state-icon ri-vip-crown-line"></i>
                    <p>用户管理功能需要 Pro 或 Ultra 版本</p>
                    <p style="color: var(--color-text-secondary); font-size: 13px; margin-top: 8px;">当前版本: Basic</p>
                </div>

                <template v-else>
                <div class="page-header">
                    <h2 class="page-header-title">
                        用户管理
                        <span class="stats-badge">{{ users.length }} 个用户</span>
                        <span class="stats-badge stats-badge--success">启用: {{ enabledUsersCount }}</span>
                    </h2>
                    <div class="page-header-actions">
                        <!-- 视图切换按钮 @author ygw -->
                        <button class="view-toggle-btn" @click="toggleUserViewMode" :data-tooltip="userViewMode === 'table' ? '切换卡片视图' : '切换表格视图'">
                            <i :class="userViewMode === 'table' ? 'ri-grid-line' : 'ri-table-line'"></i>
                        </button>
                        <button class="btn btn--secondary" @click="handleLoadUsers">
                            <i class="btn-icon ri-refresh-line"></i> 刷新
                        </button>
                        <button class="btn btn--secondary" @click="handleBatchCreateVIPUsers" title="批量创建10个VIP用户（每日1000次请求，10次/分钟频率限制）">
                            <i class="btn-icon ri-vip-crown-line"></i> 批量创建VIP
                        </button>
                        <button class="btn btn--primary" @click="handleCreateUser">
                            <i class="btn-icon ri-user-add-line"></i> 新建用户
                        </button>
                    </div>
                </div>

                <!-- 用户表格视图 @author ygw -->
                <div class="table-container user-table-container" v-if="users.length > 0 && userViewMode === 'table'">
                    <table class="data-table user-table">
                        <thead>
                            <tr>
                                <th class="col-name sortable" @click="handleUserSort('name')" :class="{'sort-active': userSortField === 'name'}">
                                    用户名
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'name' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'name' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-status">状态</th>
                                <th class="col-tokens sortable" @click="handleUserSort('total_tokens_used')" :class="{'sort-active': userSortField === 'total_tokens_used'}">
                                    Token使用
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'total_tokens_used' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'total_tokens_used' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-cost sortable" @click="handleUserSort('total_cost_usd')" :class="{'sort-active': userSortField === 'total_cost_usd'}">
                                    消费($)
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'total_cost_usd' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'total_cost_usd' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-requests sortable" @click="handleUserSort('total_requests')" :class="{'sort-active': userSortField === 'total_requests'}">
                                    总请求数
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'total_requests' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'total_requests' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-daily-requests sortable" @click="handleUserSort('daily_requests')" :class="{'sort-active': userSortField === 'daily_requests'}">
                                    当日请求
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'daily_requests' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'daily_requests' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-daily-quota">日配额</th>
                                <th class="col-monthly-quota">月配额</th>
                                <th class="col-request-quota">请求限制</th>
                                <th class="col-rate-limit">频率限制</th>
                                <th class="col-created sortable" @click="handleUserSort('created_at')" :class="{'sort-active': userSortField === 'created_at'}">
                                    创建时间
                                    <i class="ri-arrow-up-s-line" v-if="userSortField === 'created_at' && userSortOrder === 'asc'"></i>
                                    <i class="ri-arrow-down-s-line" v-if="userSortField === 'created_at' && userSortOrder === 'desc'"></i>
                                </th>
                                <th class="col-actions">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="user in sortedUsers" :key="user.id"
                                :class="{'row--enabled': user.enabled, 'row--disabled': !user.enabled}">
                                <td class="col-name">
                                    <span class="user-name-text" :data-tooltip="user.notes || ''">
                                        <i class="ri-user-line"></i>
                                        {{ user.name }}
                                        <span v-if="user.is_vip" class="vip-badge" title="VIP用户"><i class="ri-vip-crown-line"></i></span>
                                        <i v-if="user.notes" class="ri-sticky-note-line" style="color: var(--color-text-secondary); margin-left: 4px; font-size: 12px;"></i>
                                    </span>
                                </td>
                                <td class="col-status">
                                    <span class="status-badge" :class="user.enabled ? 'status-badge--enabled' : 'status-badge--disabled'">
                                        {{ user.enabled ? '启用' : '禁用' }}
                                    </span>
                                </td>
                                <td class="col-tokens">
                                    <span class="token-text">{{ formatTokenCount(user.total_tokens_used) }}</span>
                                </td>
                                <td class="col-cost">
                                    <span class="cost-text">{{ formatCostUSD(user.total_cost_usd) }}</span>
                                </td>
                                <td class="col-requests">
                                    <span class="count-text">{{ user.total_requests || 0 }}</span>
                                </td>
                                <td class="col-daily-requests">
                                    <span class="count-text">{{ user.daily_requests || 0 }}</span>
                                </td>
                                <td class="col-daily-quota">
                                    <span class="quota-text">{{ user.daily_quota > 0 ? formatTokenCount(user.daily_quota) : '-' }}</span>
                                </td>
                                <td class="col-monthly-quota">
                                    <span class="quota-text">{{ user.monthly_quota > 0 ? formatTokenCount(user.monthly_quota) : '-' }}</span>
                                </td>
                                <td class="col-request-quota">
                                    <span class="quota-text">{{ user.request_quota > 0 ? (user.request_quota + '次/日') : '-' }}</span>
                                </td>
                                <td class="col-rate-limit">
                                    <span class="quota-text">{{ user.rate_limit_rpm > 0 ? (user.rate_limit_rpm + '次/分') : '-' }}</span>
                                </td>
                                <td class="col-created">
                                    <span class="created-text">{{ formatCreatedTime(user.created_at) }}</span>
                                </td>
                                <td class="col-actions">
                                    <div class="action-buttons">
                                        <button class="btn btn--mini" @click="handleShowUserIPs(user)" data-tooltip="关联IP">
                                            <i class="ri-global-line"></i>
                                        </button>
                                        <button class="btn btn--mini" @click="handleShowUserStats(user)" data-tooltip="统计">
                                            <i class="ri-line-chart-line"></i>
                                        </button>
                                        <button class="btn btn--mini" @click="handleEditUser(user)" data-tooltip="编辑">
                                            <i class="ri-edit-line"></i>
                                        </button>
                                        <button class="btn btn--mini" @click="handleRegenerateAPIKey(user)" data-tooltip="重置Key">
                                            <i class="ri-key-line"></i>
                                        </button>
                                        <button class="btn btn--mini btn--danger" @click="handleDeleteUser(user)" data-tooltip="删除">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 用户卡片视图 -->
                <div class="users-grid" v-if="users.length > 0 && userViewMode === 'card'">
                    <div v-for="user in users" :key="user.id" class="user-card" :class="{'user-card--disabled': !user.enabled}">
                        <div class="user-card-header">
                            <div class="user-card-title">
                                <i class="ri-user-line"></i>
                                {{ user.name }}
                                <span v-if="user.is_vip" class="vip-badge" title="VIP用户"><i class="ri-vip-crown-line"></i></span>
                            </div>
                            <span class="stats-badge" :class="user.enabled ? 'stats-badge--success' : 'stats-badge--error'">
                                {{ user.enabled ? '启用' : '禁用' }}
                            </span>
                        </div>

                        <div class="user-card-body">
                            <div class="user-card-field">
                                <label>API Key</label>
                                <div class="user-api-key">
                                    <code>****</code>
                                </div>
                            </div>
                            <div class="user-card-field">
                                <label>Token使用</label>
                                <span>{{ formatTokenCount(user.total_tokens_used) }}</span>
                            </div>
                            <div class="user-card-field" v-if="user.daily_quota > 0">
                                <label>日配额</label>
                                <span>{{ formatTokenCount(user.daily_quota) }}</span>
                            </div>
                            <div class="user-card-field" v-if="user.monthly_quota > 0">
                                <label>月配额</label>
                                <span>{{ formatTokenCount(user.monthly_quota) }}</span>
                            </div>
                        </div>

                        <div class="user-card-actions">
                            <button class="btn btn--secondary" @click="handleShowUserIPs(user)">
                                <i class="ri-global-line"></i> 关联IP
                            </button>
                            <button class="btn btn--secondary" @click="handleShowUserStats(user)">
                                <i class="ri-line-chart-line"></i> 统计
                            </button>
                            <button class="btn btn--secondary" @click="handleEditUser(user)">
                                <i class="ri-edit-line"></i> 编辑
                            </button>
                            <button class="btn btn--secondary" @click="handleRegenerateAPIKey(user)">
                                <i class="ri-key-line"></i> 重置Key
                            </button>
                            <button class="btn btn--danger" @click="handleDeleteUser(user)">
                                <i class="ri-delete-bin-line"></i> 删除
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 空状态 -->
                <div class="empty-state" v-if="users.length === 0">
                    <i class="empty-state-icon ri-user-line"></i>
                    <p>暂无用户，点击右上角创建</p>
                </div>
                </template>
            </section>

            <!-- Tab 面板: 请求日志 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'logs'}">
                <div class="page-header">
                    <h2 class="page-header-title">请求日志</h2>
                    <div class="page-header-actions">
                        <button class="btn btn--secondary" @click="handleToggleLogsStatsPanel">
                            <i class="btn-icon" :class="showLogsStatsPanel ? 'ri-arrow-up-s-line' : 'ri-bar-chart-line'"></i> {{ showLogsStatsPanel ? '收起统计' : '展开统计' }}
                        </button>
                        <button class="btn btn--secondary" @click="handleCleanupLogs">
                            <i class="btn-icon ri-delete-bin-line"></i> 清理旧日志
                        </button>
                        <button class="btn" :class="logsAutoRefresh ? 'btn--primary' : 'btn--secondary'" @click="handleToggleLogsAutoRefresh">
                            <i class="btn-icon" :class="logsAutoRefresh ? 'ri-pause-line' : 'ri-play-line'"></i> {{ logsAutoRefresh ? '停止自动刷新' : '开启自动刷新' }}
                        </button>
                        <button class="btn btn--primary" @click="handleLoadLogs" :disabled="logsLoading">
                            <i class="btn-icon ri-refresh-line" :class="{'is-spinning': logsLoading}"></i> 刷新
                        </button>
                    </div>
                </div>

                <!-- 统计卡片 -->
                <div v-if="logsStats && showLogsStatsPanel" class="stats-grid" style="margin-top: 12px;">
                    <div class="stats-card stats-card--bg-accent">
                        <div class="stats-card-label">总请求数</div>
                        <div class="stats-card-value">{{ logsStats.total_requests }}</div>
                    </div>
                    <div class="stats-card stats-card--bg-success">
                        <div class="stats-card-label">成功率</div>
                        <div class="stats-card-value">{{ logsStats.success_rate.toFixed(2) }}%</div>
                    </div>
                    <div class="stats-card stats-card--bg-muted">
                        <div class="stats-card-label">平均响应时间</div>
                        <div class="stats-card-value">{{ logsStats.avg_duration_ms.toFixed(0) }}ms</div>
                    </div>
                    <div class="stats-card stats-card--bg-accent">
                        <div class="stats-card-label">Token消耗</div>
                        <div class="stats-card-value">{{ logsStats.total_input_tokens + logsStats.total_output_tokens }}</div>
                    </div>
                    <div class="stats-card stats-card--bg-success">
                        <div class="stats-card-label">总消费</div>
                        <div class="stats-card-value">{{ formatCostUSD(logsStats.total_cost_usd) }}</div>
                    </div>
                </div>

                <!-- 筛选器 -->
                <div class="filter-bar" style="margin-bottom: 15px; padding: 15px; background: var(--color-bg-elevated); border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 10px;">
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">开始时间</label>
                            <input type="datetime-local" class="form-input" v-model="logsFilters.startTime" style="font-size: 12px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">结束时间</label>
                            <input type="datetime-local" class="form-input" v-model="logsFilters.endTime" style="font-size: 12px;">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">账号</label>
                            <div class="custom-select" :class="{ 'is-open': accountSelectOpen }">
                                <div class="custom-select-trigger" @click="accountSelectOpen = !accountSelectOpen">
                                    <span>{{ logsFilters.accountID ? (accounts.find(a => a.id === logsFilters.accountID)?.label || `#${getAccountShortId(logsFilters.accountID)}`) : '所有账号' }}</span>
                                    <i class="ri-arrow-down-s-line"></i>
                                </div>
                                <div class="custom-select-options" v-show="accountSelectOpen">
                                    <div class="custom-select-option" :class="{ 'is-selected': !logsFilters.accountID }" @click="logsFilters.accountID = ''; accountSelectOpen = false">所有账号</div>
                                    <div class="custom-select-option" v-for="account in accounts" :key="account.id" :class="{ 'is-selected': logsFilters.accountID === account.id }" @click="logsFilters.accountID = account.id; accountSelectOpen = false">
                                        {{ account.label || `#${getAccountShortId(account.id)}` }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">客户端IP</label>
                            <input type="text" class="form-input" v-model="logsFilters.clientIP" placeholder="输入IP地址">
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">端点类型</label>
                            <div class="custom-select" :class="{ 'is-open': endpointSelectOpen }">
                                <div class="custom-select-trigger" @click="endpointSelectOpen = !endpointSelectOpen">
                                    <span>{{ logsFilters.endpointType === '' ? '所有端点' : (logsFilters.endpointType === 'openai' ? 'OpenAI' : 'Claude') }}</span>
                                    <i class="ri-arrow-down-s-line"></i>
                                </div>
                                <div class="custom-select-options" v-show="endpointSelectOpen">
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.endpointType === '' }" @click="logsFilters.endpointType = ''; endpointSelectOpen = false">所有端点</div>
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.endpointType === 'openai' }" @click="logsFilters.endpointType = 'openai'; endpointSelectOpen = false">OpenAI</div>
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.endpointType === 'claude' }" @click="logsFilters.endpointType = 'claude'; endpointSelectOpen = false">Claude</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label style="display: block; font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">请求状态</label>
                            <div class="custom-select" :class="{ 'is-open': statusSelectOpen }">
                                <div class="custom-select-trigger" @click="statusSelectOpen = !statusSelectOpen">
                                    <span>{{ logsFilters.isSuccess === '' ? '所有状态' : (logsFilters.isSuccess === 'true' ? '成功' : '失败') }}</span>
                                    <i class="ri-arrow-down-s-line"></i>
                                </div>
                                <div class="custom-select-options" v-show="statusSelectOpen">
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.isSuccess === '' }" @click="logsFilters.isSuccess = ''; statusSelectOpen = false">所有状态</div>
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.isSuccess === 'true' }" @click="logsFilters.isSuccess = 'true'; statusSelectOpen = false">成功</div>
                                    <div class="custom-select-option" :class="{ 'is-selected': logsFilters.isSuccess === 'false' }" @click="logsFilters.isSuccess = 'false'; statusSelectOpen = false">失败</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn--secondary" @click="handleSetLogsTimeRange('1h')">最近1小时</button>
                        <button class="btn btn--secondary" @click="handleSetLogsTimeRange('today')">当天</button>
                        <button class="btn btn--secondary" @click="handleSetLogsTimeRange('24h')">最近24小时</button>
                        <button class="btn btn--secondary" @click="handleSetLogsTimeRange('7d')">最近7天</button>
                        <button class="btn btn--secondary" @click="handleResetLogsFilters">重置</button>
                        <button class="btn btn--primary" @click="handleLoadLogs">查询</button>
                    </div>
                </div>

                <!-- 日志表格 -->
                <div class="table-container" style="position: relative;">
                    <div v-if="logsLoading" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--color-bg-elevated); opacity: 0.7; z-index: 10; display: flex; align-items: center; justify-content: center;">
                        <i class="ri-loader-4-line is-spinning" style="font-size: 24px; color: var(--color-primary);"></i>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>归属</th>
                                <th>账号ID</th>
                                <th>客户端IP</th>
                                <th>路径</th>
                                <th>状态</th>
                                <th>耗时</th>
                                <th>Token</th>
                                <th>消费</th>
                                <th>错误信息</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="log in logs" :key="log.id" @click="handleShowLogDetail(log)" style="cursor: pointer;">
                                <td>{{ formatLogTime(log.timestamp) }}</td>
                                <td>
                                    <span v-if="log.user_type === 'admin'" class="user-badge user-badge--admin">
                                        <i class="ri-shield-star-fill"></i>{{ log.user_name || '管理员' }}
                                    </span>
                                    <span v-else-if="log.user_type === 'vip'" class="user-badge user-badge--vip">
                                        <i class="ri-vip-crown-fill"></i>{{ log.user_name }}
                                    </span>
                                    <span v-else-if="log.user_name" class="user-badge user-badge--normal">
                                        <i class="ri-user-line"></i>{{ log.user_name }}
                                    </span>
                                    <span v-else style="color: var(--color-text-secondary);">-</span>
                                </td>
                                <td>
                                    <code v-if="log.account_id" style="font-size: 11px;">{{ getAccountShortId(log.account_id) }}</code>
                                    <span v-else style="color: var(--color-text-secondary);">-</span>
                                </td>
                                <td>
                                    <a href="javascript:void(0)" @click.stop="handleFilterByIP(log.client_ip)" class="ip-link" data-tooltip="点击筛选此IP">{{ formatClientIP(log.client_ip) }}</a>
                                </td>
                                <td><code style="font-size: 11px;">{{ log.path }}</code></td>
                                <td>
                                    <span class="badge" :class="log.is_success ? 'badge--success' : 'badge--error'">
                                        {{ log.status_code }}
                                    </span>
                                </td>
                                <td>{{ formatDuration(log.duration_ms) }}</td>
                                <td>{{ log.input_tokens + log.output_tokens }}</td>
                                <td>{{ formatCostUSD(log.cost_usd) }}</td>
                                <td>
                                    <span v-if="log.error_message"
                                          class="error-message-cell"
                                          :data-tooltip="log.error_message">
                                        {{ log.error_message.substring(0, 50) }}{{ log.error_message.length > 50 ? '...' : '' }}
                                    </span>
                                    <span v-else style="color: var(--color-text-secondary);">-</span>
                                </td>
                            </tr>
                            <tr v-if="logs.length === 0">
                                <td colspan="10" style="text-align: center; color: var(--color-text-secondary);">暂无日志</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 分页 -->
                <div class="pagination-bar" v-if="logsTotal > 0">
                    <span class="pagination-info">
                        共 {{ logsTotal }} 条，第 <strong>{{ logsCurrentPage }}</strong>/{{ logsTotalPages || 1 }} 页
                    </span>
                    <div class="pagination-buttons">
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleLogsGoToPage(1)" :disabled="logsCurrentPage <= 1 || logsLoading" data-tooltip="首页">
                            <i class="ri-skip-back-mini-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleLogsPrevPage" :disabled="logsOffset === 0 || logsLoading" data-tooltip="上一页">
                            <i class="ri-arrow-left-s-line"></i>
                        </button>
                        <button v-for="page in logsPageNumbers" :key="page"
                                class="btn btn--sm pagination-btn"
                                :class="page === logsCurrentPage ? 'btn--primary' : 'btn--secondary'"
                                @click="handleLogsGoToPage(page)" :disabled="logsLoading">
                            {{ page }}
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleLogsNextPage" :disabled="logs.length < logsLimit || logsLoading" data-tooltip="下一页">
                            <i class="ri-arrow-right-s-line"></i>
                        </button>
                        <button class="btn btn--sm btn--secondary pagination-btn" @click="handleLogsGoToPage(logsTotalPages)" :disabled="logsCurrentPage >= logsTotalPages || logsLoading" data-tooltip="末页">
                            <i class="ri-skip-forward-mini-line"></i>
                        </button>
                    </div>
                    <div class="pagination-jump">
                        <input type="number" v-model="logsPageJump" @keyup.enter="handleLogsJumpToPage"
                               placeholder="页码" min="1" :max="logsTotalPages" class="pagination-input">
                        <button class="btn btn--sm btn--secondary" @click="handleLogsJumpToPage" :disabled="logsLoading">
                            跳转
                        </button>
                    </div>
                </div>
            </section>

            <!-- Tab 面板: IP管理 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'ips'}">
                <div class="page-header">
                    <h2 class="page-header-title">IP管理</h2>
                    <div class="page-header-actions">
                        <button class="btn btn--primary" @click="handleLoadAllIPs" :disabled="ipsLoading">
                            <i class="btn-icon ri-refresh-line" :class="{'is-spinning': ipsLoading}"></i> 刷新
                        </button>
                    </div>
                </div>

                <!-- 筛选和操作栏 -->
                <div style="margin-bottom: 15px; padding: 15px; background: var(--color-bg-elevated); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px;">
                        <!-- 左侧：Tab切换 -->
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn--sm" :class="ipViewMode === 'visitors' ? 'btn--primary' : 'btn--secondary'" @click="ipViewMode = 'visitors'">
                                <i class="ri-user-line"></i> 访问列表
                            </button>
                            <button class="btn btn--sm" :class="ipViewMode === 'blocked' ? 'btn--primary' : 'btn--secondary'" @click="ipViewMode = 'blocked'">
                                <i class="ri-forbid-line"></i> 封禁列表
                            </button>
                        </div>
                        <!-- 右侧：快速封禁 -->
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="text" class="form-input" v-model="newBlockIP" placeholder="IP地址" style="width: 150px; height: 32px; font-size: 13px;">
                            <input type="text" class="form-input" v-model="newBlockReason" placeholder="封禁原因（可选）" style="width: 200px; height: 32px; font-size: 13px;">
                            <button class="btn btn--sm btn--danger" @click="handleBlockIP">
                                <i class="ri-forbid-line"></i> 封禁
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 访问IP列表 -->
                <div class="table-container ip-table-container" v-show="ipViewMode === 'visitors'" style="flex: 1; overflow-y: auto;">
                    <table class="data-table ip-table">
                        <thead style="position: sticky; top: 0; background: var(--color-bg-elevated); z-index: 10;">
                            <tr>
                                <th>IP地址</th>
                                <th>备注</th>
                                <th>用户</th>
                                <th style="cursor: pointer; user-select: none;" @click="toggleIPSort('last_visit')">
                                    最近访问
                                    <i v-if="ipSortField === 'last_visit'" :class="ipSortOrder === 'desc' ? 'ri-arrow-down-s-line' : 'ri-arrow-up-s-line'"></i>
                                </th>
                                <th style="cursor: pointer; user-select: none;" @click="toggleIPSort('request_count')">
                                    总请求
                                    <i v-if="ipSortField === 'request_count'" :class="ipSortOrder === 'desc' ? 'ri-arrow-down-s-line' : 'ri-arrow-up-s-line'"></i>
                                </th>
                                <th style="cursor: pointer; user-select: none;" @click="toggleIPSort('request_count_day')">
                                    最近24h
                                    <i v-if="ipSortField === 'request_count_day'" :class="ipSortOrder === 'desc' ? 'ri-arrow-down-s-line' : 'ri-arrow-up-s-line'"></i>
                                </th>
                                <th style="cursor: pointer; user-select: none;" @click="toggleIPSort('request_count_hour')">
                                    最近1h
                                    <i v-if="ipSortField === 'request_count_hour'" :class="ipSortOrder === 'desc' ? 'ri-arrow-down-s-line' : 'ri-arrow-up-s-line'"></i>
                                </th>
                                <th>成功率</th>
                                <th>限制</th>
                                <th style="text-align: right;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="ip in sortedVisitorIPs" :key="ip.ip">
                                <td><code class="ip-code">{{ ip.ip }}</code></td>
                                <td class="ip-notes-cell">
                                    <template v-if="editingIPNotes === ip.ip">
                                        <div class="ip-notes-edit">
                                            <input type="text" class="form-input ip-notes-input" v-model="editingIPNotesValue" 
                                                   @keyup.enter="saveIPNotes(ip.ip)" @keyup.esc="cancelEditIPNotes" 
                                                   placeholder="输入备注..." style="height: 26px; font-size: 12px; width: 100px;">
                                            <button class="btn btn--mini" @click="saveIPNotes(ip.ip)" data-tooltip="保存"><i class="ri-check-line"></i></button>
                                            <button class="btn btn--mini" @click="cancelEditIPNotes" data-tooltip="取消"><i class="ri-close-line"></i></button>
                                        </div>
                                    </template>
                                    <template v-else>
                                        <span class="ip-notes-text" @click="startEditIPNotes(ip)" :title="ip.notes || '点击添加备注'">
                                            {{ ip.notes || '-' }}
                                            <i class="ri-edit-line ip-notes-edit-icon"></i>
                                        </span>
                                    </template>
                                </td>
                                <td>
                                    <span v-if="ip.user_name" class="user-badge user-badge--vip">
                                        <i class="ri-user-star-line"></i>{{ ip.user_name }}
                                    </span>
                                    <span v-else class="user-badge user-badge--normal">
                                        <i class="ri-user-line"></i>匿名
                                    </span>
                                </td>
                                <td class="ip-time-cell">{{ formatIPTime(ip.last_visit) }}</td>
                                <td>{{ ip.request_count }}</td>
                                <td>
                                    <span class="badge badge--info">{{ ip.request_count_day || 0 }}</span>
                                </td>
                                <td>
                                    <span class="badge" :class="ip.request_count_hour > 50 ? 'badge--warning' : 'badge--success'">{{ ip.request_count_hour || 0 }}</span>
                                </td>
                                <td>
                                    <span class="badge" :class="ip.success_count === ip.request_count ? 'badge--success' : 'badge--warning'">
                                        {{ ip.success_count }}/{{ ip.request_count }}
                                    </span>
                                </td>
                                <td class="ip-limits-cell">
                                    <span v-if="ip.rate_limit_rpm > 0 || ip.daily_request_limit > 0" class="ip-limits-badge" @click="openIPConfigModal(ip)">
                                        <span v-if="ip.rate_limit_rpm > 0">{{ ip.rate_limit_rpm }}/分</span>
                                        <span v-if="ip.rate_limit_rpm > 0 && ip.daily_request_limit > 0"> | </span>
                                        <span v-if="ip.daily_request_limit > 0">{{ ip.daily_request_limit }}/日</span>
                                    </span>
                                    <span v-else class="ip-limits-none" @click="openIPConfigModal(ip)">-</span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn--mini" @click="openIPConfigModal(ip)" data-tooltip="配置">
                                            <i class="ri-settings-3-line"></i>
                                        </button>
                                        <button class="btn btn--mini" @click="handleViewIPLogs(ip.ip)" data-tooltip="日志">
                                            <i class="ri-file-list-line"></i>
                                        </button>
                                        <button v-if="!isIPBlocked(ip.ip)" class="btn btn--mini btn--danger" @click="handleQuickBlockIP(ip.ip)" data-tooltip="封禁">
                                            <i class="ri-forbid-line"></i>
                                        </button>
                                        <button v-else class="btn btn--mini btn--success" @click="handleUnblockIP(ip.ip)" data-tooltip="解封">
                                            <i class="ri-check-line"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr v-if="sortedVisitorIPs.length === 0">
                                <td colspan="10" style="text-align: center; color: var(--color-text-secondary);">暂无访问记录</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 封禁IP列表 -->
                <div class="table-container" v-show="ipViewMode === 'blocked'">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>IP地址</th>
                                <th>封禁原因</th>
                                <th>封禁时间</th>
                                <th style="text-align: right;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="ip in blockedIPs" :key="ip.ip">
                                <td><code>{{ ip.ip }}</code></td>
                                <td>{{ ip.reason || '-' }}</td>
                                <td>{{ formatIPTime(ip.created_at) }}</td>
                                <td>
                                    <div style="display: flex; gap: 6px; justify-content: flex-end;">
                                        <button class="btn btn--small btn--success" @click="handleUnblockIP(ip.ip)" data-tooltip="解封IP">
                                            <i class="ri-check-line"></i> 解封
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr v-if="blockedIPs.length === 0">
                                <td colspan="4" style="text-align: center; color: var(--color-text-secondary);">暂无封禁IP</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Tab 面板: 系统配置 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'settings'}">
                <div class="settings-container">
                    <div class="settings-grid">
                        <!-- 基础配置 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-settings-3-line"></i>
                                <h3>基础配置</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <label class="form-label">管理密码</label>
                                    <input type="text" class="form-input" v-model="settingsData.adminPassword" placeholder="输入管理密码">
                                    <small class="form-hint">密码，自己一定要记得，忘记了就进不来了</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">API Key</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="text" class="form-input" v-model="settingsData.apiKey" placeholder="留空则无需验证" style="flex: 1;">
                                        <button class="btn btn--sm btn--secondary" @click="handleGenerateAPIKey" data-tooltip="生成符合 Claude API 格式的 Key">
                                            <i class="ri-refresh-line"></i>
                                        </button>
                                    </div>
                                    <small class="form-hint" style="color: var(--color-danger);">建议不要修改，如需多用户使用请在「用户管理」中创建用户</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">服务端口</label>
                                    <input type="number" class="form-input" v-model.number="settingsData.port" min="1" max="65535" placeholder="默认 62311">
                                    <small class="form-hint">默认 62311，修改后保存并重启服务生效</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">账号失败自动禁用阈值</label>
                                    <input type="number" class="form-input" v-model.number="settingsData.maxErrorCount" min="1" max="1000">
                                    <small class="form-hint">账号错误/重试次数达到该值后自动禁用</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">账号选择方式</label>
                                    <div class="custom-select" :class="{ 'is-open': accountSelectionModeSelectOpen }">
                                        <div class="custom-select-trigger" @click="accountSelectionModeSelectOpen = !accountSelectionModeSelectOpen">
                                            <span>{{ getAccountSelectionModeLabel(settingsData.accountSelectionMode) }}</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </div>
                                        <div class="custom-select-options" v-show="accountSelectionModeSelectOpen">
                                            <div v-for="mode in settingsData.supportedAccountSelectionModes" 
                                                 :key="mode.value"
                                                 class="custom-select-option" 
                                                 :class="{ 'is-selected': settingsData.accountSelectionMode === mode.value }" 
                                                 @click="settingsData.accountSelectionMode = mode.value; accountSelectionModeSelectOpen = false">
                                                <div style="font-weight: 500;">{{ mode.label }}</div>
                                                <small style="color: var(--color-text-secondary); font-size: 11px;">{{ mode.description }}</small>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-hint">选择多账号时的分配策略，加权随机会根据配额剩余和使用情况智能分配</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">HTTP/SOCKS5 代理</label>
                                    <input type="text" class="form-input" v-model="settingsData.httpProxy" placeholder="http://proxy:port 或 socks5://user:pass@proxy:port">
                                    <small class="form-hint">支持 HTTP/HTTPS/SOCKS5 代理，格式：http://proxy:port 或 socks5://user:pass@proxy:port（留空表示不使用代理）</small>
                                </div>
                                <!-- 代理池配置 -->
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用代理池</div>
                                            <small class="form-hint" style="margin: 0;">使用多代理轮换，支持 Session 派生（同一账号使用同一出口 IP）</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.proxyPoolEnabled">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group" v-if="settingsData.proxyPoolEnabled">
                                    <label class="form-label">代理选择策略</label>
                                    <div class="custom-select" :class="{ 'is-open': proxyStrategySelectOpen }">
                                        <div class="custom-select-trigger" @click="proxyStrategySelectOpen = !proxyStrategySelectOpen">
                                            <span>{{ settingsData.proxyPoolStrategy === 'round_robin' ? '轮询 (Round Robin)' : (settingsData.proxyPoolStrategy === 'random' ? '随机 (Random)' : '加权随机 (Weighted)') }}</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </div>
                                        <div class="custom-select-options" v-show="proxyStrategySelectOpen">
                                            <div class="custom-select-option" :class="{ 'is-selected': settingsData.proxyPoolStrategy === 'round_robin' }" @click="settingsData.proxyPoolStrategy = 'round_robin'; proxyStrategySelectOpen = false">轮询 (Round Robin)</div>
                                            <div class="custom-select-option" :class="{ 'is-selected': settingsData.proxyPoolStrategy === 'random' }" @click="settingsData.proxyPoolStrategy = 'random'; proxyStrategySelectOpen = false">随机 (Random)</div>
                                            <div class="custom-select-option" :class="{ 'is-selected': settingsData.proxyPoolStrategy === 'weighted' }" @click="settingsData.proxyPoolStrategy = 'weighted'; proxyStrategySelectOpen = false">加权随机 (Weighted)</div>
                                        </div>
                                    </div>
                                    <small class="form-hint">轮询：依次使用每个代理；随机：随机选择代理；加权：按权重随机选择</small>
                                </div>
                                <div class="form-group" v-if="settingsData.proxyPoolEnabled">
                                    <label class="form-label">代理列表管理</label>
                                    <button class="btn btn-secondary" @click="showProxyPoolModal = true; loadProxyList()">
                                        <i class="ri-settings-3-line"></i> 管理代理池 ({{ proxyList.length }} 个)
                                    </button>
                                    <small class="form-hint">点击管理代理池中的代理配置，支持 Session 派生（URL 中使用 % 作为占位符）</small>
                                </div>
                            </div>
                        </div>

                        <!-- 模型配置 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-cpu-line"></i>
                                <h3>模型配置</h3>
                            </div>
                            <div class="settings-card-body">
                                <!-- 智能压缩 -->
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用智能压缩</div>
                                            <small class="form-hint" style="margin: 0;">当对话超过阈值时自动压缩历史消息，减少 Token 消耗</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.compressionEnabled">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group" v-if="settingsData.compressionEnabled">
                                    <label class="form-label">压缩模型</label>
                                    <div class="custom-select settings-model-select" :class="{ 'is-open': compressionModelSelectOpen }">
                                        <div class="custom-select-trigger" @click="compressionModelSelectOpen = !compressionModelSelectOpen">
                                            <span>{{ settingsData.compressionModel || '选择模型...' }}</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </div>
                                        <div class="custom-select-options" v-show="compressionModelSelectOpen">
                                            <div v-for="model in settingsData.supportedCompressionModels"
                                                 :key="model"
                                                 class="custom-select-option"
                                                 :class="{ 'is-selected': settingsData.compressionModel === model }"
                                                 @click="settingsData.compressionModel = model; compressionModelSelectOpen = false">
                                                {{ model }}
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-hint">用于生成对话摘要的模型，推荐使用 Haiku 平衡速度与质量</small>
                                </div>

                                <!-- 分隔线 -->
                                <div class="settings-divider" style="margin: 16px 0; border-top: 1px solid var(--color-border);"></div>

                                <!-- 强制模型 -->
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用强制模型</div>
                                            <small class="form-hint" style="margin: 0;">忽略用户请求中指定的模型，统一使用选定的模型</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.forceModelEnabled">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group" v-if="settingsData.forceModelEnabled">
                                    <label class="form-label">强制使用模型</label>
                                    <div class="custom-select settings-model-select" :class="{ 'is-open': forceModelSelectOpen }">
                                        <div class="custom-select-trigger" @click="forceModelSelectOpen = !forceModelSelectOpen">
                                            <span>{{ settingsData.forceModel || '选择模型...' }}</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </div>
                                        <div class="custom-select-options" v-show="forceModelSelectOpen">
                                            <div v-for="model in settingsData.supportedForceModels"
                                                 :key="model"
                                                 class="custom-select-option"
                                                 :class="{ 'is-selected': settingsData.forceModel === model }"
                                                 @click="settingsData.forceModel = model; forceModelSelectOpen = false">
                                                {{ model }}
                                            </div>
                                        </div>
                                    </div>
                                    <small class="form-hint">所有请求将使用此模型，原始请求模型会记录在日志中</small>
                                </div>
                            </div>
                        </div>

                        <!-- 公告配置 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-notification-3-line"></i>
                                <h3>公告配置</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用公告跑马灯</div>
                                            <small class="form-hint" style="margin: 0;">在页面顶部显示滚动公告</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.announcementEnabled">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group" v-if="settingsData.announcementEnabled">
                                    <label class="form-label">公告内容</label>
                                    <input type="text" class="form-input" v-model="settingsData.announcementText" placeholder="输入公告内容">
                                </div>
                            </div>
                        </div>

                        <!-- 界面与性能 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-layout-line"></i>
                                <h3>界面与性能</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">宽屏铺满布局</div>
                                            <small class="form-hint" style="margin: 0;">关闭后在大屏居中显示、限制最大宽度</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.layoutFullWidth">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <!-- 配额同步配置（合并了配额刷新和状态检查） -->
                                <div class="settings-divider" style="margin: 16px 0; border-top: 1px solid var(--color-border);"></div>
                                <div style="font-weight: 600; font-size: 13px; color: var(--color-text-secondary); margin-bottom: 12px;">
                                    <i class="ri-speed-line" style="margin-right: 4px;"></i>配额同步配置
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label" style="font-size: 12px;">同步并发数</label>
                                        <input type="number" class="form-input" v-model.number="settingsData.quotaRefreshConcurrency" min="1" max="50" style="padding: 6px 10px;">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0;">
                                        <label class="form-label" style="font-size: 12px;">同步间隔(秒)</label>
                                        <input type="number" class="form-input" v-model.number="settingsData.quotaRefreshInterval" min="60" max="600" style="padding: 6px 10px;">
                                    </div>
                                </div>
                                <small class="form-hint" style="margin-top: 8px; display: block;">配额同步会同时更新配额数据和检查账号状态；SQLite 建议并发 5-10，MySQL 可设 20-50</small>
                            </div>
                        </div>

                        <!-- 请求日志配置 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-file-list-3-line"></i>
                                <h3>请求日志</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用请求日志</div>
                                            <small class="form-hint" style="margin: 0;">记录所有API请求的详细信息</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.enableRequestLog">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">日志保留天数</label>
                                    <input type="number" class="form-input" v-model.number="settingsData.logRetentionDays" min="1" max="365">
                                    <small class="form-hint">超过此天数的日志将被自动清理</small>
                                </div>
                            </div>
                        </div>

                        <!-- IP访问控制 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-shield-keyhole-line"></i>
                                <h3>IP访问控制</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <label class="toggle-wrapper">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">启用IP频率限制</div>
                                            <small class="form-hint" style="margin: 0;">限制单个IP的请求频率，防止滥用</small>
                                        </div>
                                        <div class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" v-model="settingsData.enableIPRateLimit">
                                            <span class="toggle-slider"></span>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-group" v-if="settingsData.enableIPRateLimit">
                                    <label class="form-label">时间窗口（分钟）</label>
                                    <input type="number" class="form-input" v-model.number="settingsData.ipRateLimitWindow" min="1" max="60">
                                    <small class="form-hint">统计请求数的时间窗口</small>
                                </div>
                                <div class="form-group" v-if="settingsData.enableIPRateLimit">
                                    <label class="form-label">最大请求数</label>
                                    <input type="number" class="form-input" v-model.number="settingsData.ipRateLimitMax" min="1" max="10000">
                                    <small class="form-hint">时间窗口内允许的最大请求数</small>
                                </div>
                            </div>
                        </div>

                        <!-- 账号统计管理 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-bar-chart-line"></i>
                                <h3>账号统计</h3>
                            </div>
                            <div class="settings-card-body">
                                <div class="form-group">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">同步账号邮箱</div>
                                            <small class="form-hint" style="margin: 0;">同步缺少邮箱的账号的邮箱信息</small>
                                        </div>
                                        <button class="btn btn--secondary" @click="handleSyncEmails" :disabled="isSyncingEmails">
                                            <i class="btn-icon ri-mail-check-line" :class="{'spin-animation': isSyncingEmails}"></i> 同步邮箱
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <div style="font-weight: 600; font-size: 13px; color: var(--color-text-primary); margin-bottom: 4px;">清除所有账号数据</div>
                                            <small class="form-hint" style="margin: 0;">将账号计数归零并清除所有请求日志</small>
                                        </div>
                                        <button class="btn btn--secondary btn--danger" @click="handleResetAllAccountStats" :disabled="isResettingAccountStats">
                                            <i class="btn-icon ri-delete-bin-line" :class="{'spin-animation': isResettingAccountStats}"></i> 清除数据
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 数据备份 -->
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <i class="ri-database-2-line"></i>
                                <h3>数据备份</h3>
                            </div>
                            <div class="settings-card-body">
                                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                                    <span class="form-hint" style="margin: 0;">⚠️ 导入备份将覆盖所有数据</span>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn btn--secondary" @click="handleExportBackup">
                                            <i class="btn-icon ri-download-line"></i> 导出备份
                                        </button>
                                        <button class="btn btn--secondary" @click="handleImportBackup">
                                            <i class="btn-icon ri-upload-line"></i> 导入备份
                                        </button>
                                    </div>
                                </div>
                                <input type="file" ref="backupImportInput" accept=".json" style="display:none" @change="handleBackupImportFileChange">
                            </div>
                        </div>

                        <!-- 保存按钮 -->
                        <div class="settings-card--full" style="display: flex; justify-content: center; padding: 10px 0;">
                            <button class="btn btn--primary" @click="handleSaveSettings" style="min-width: 200px;">
                                <i class="btn-icon ri-save-line"></i> 保存配置
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 面板: 服务日志 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'serverLogs'}">
                <div class="page-header">
                    <h2 class="page-header-title">
                        服务日志
                        <span class="stats-badge" :class="serverLogsConnected ? 'badge--success' : 'badge--error'">
                            <i :class="serverLogsConnected ? 'ri-wifi-line' : 'ri-wifi-off-line'"></i>
                            {{ serverLogsConnected ? '已连接' : '未连接' }}
                        </span>
                    </h2>
                    <div class="page-header-actions">
                        <div class="form-group" style="margin: 0; min-width: 200px;">
                            <input type="text" class="form-input" v-model="serverLogsFilter" placeholder="搜索日志...">
                        </div>
                        <div class="custom-select" :class="{ 'is-open': logLevelSelectOpen }">
                            <div class="custom-select-trigger" @click="logLevelSelectOpen = !logLevelSelectOpen">
                                <span>{{ serverLogsLevel === 'all' ? '全部级别' : serverLogsLevel.toUpperCase() }}</span>
                                <i class="ri-arrow-down-s-line"></i>
                            </div>
                            <div class="custom-select-options" v-show="logLevelSelectOpen">
                                <div class="custom-select-option" :class="{ 'is-selected': serverLogsLevel === 'all' }" @click="serverLogsLevel = 'all'; logLevelSelectOpen = false">全部级别</div>
                                <div class="custom-select-option" :class="{ 'is-selected': serverLogsLevel === 'info' }" @click="serverLogsLevel = 'info'; logLevelSelectOpen = false">INFO</div>
                                <div class="custom-select-option" :class="{ 'is-selected': serverLogsLevel === 'warn' }" @click="serverLogsLevel = 'warn'; logLevelSelectOpen = false">WARN</div>
                                <div class="custom-select-option" :class="{ 'is-selected': serverLogsLevel === 'error' }" @click="serverLogsLevel = 'error'; logLevelSelectOpen = false">ERROR</div>
                                <div class="custom-select-option" :class="{ 'is-selected': serverLogsLevel === 'debug' }" @click="serverLogsLevel = 'debug'; logLevelSelectOpen = false">DEBUG</div>
                            </div>
                        </div>
                        <label class="checkbox-label" style="margin: 0 8px;">
                            <input type="checkbox" :checked="serverLogsAutoScroll" @change="toggleServerLogsAutoScroll">
                            <span>自动滚动</span>
                        </label>
                        <button class="btn btn--secondary" @click="clearServerLogs">
                            <i class="btn-icon ri-delete-bin-line"></i> 清空
                        </button>
                        <button class="btn btn--secondary" @click="exportServerLogs" :disabled="serverLogs.length === 0">
                            <i class="btn-icon ri-download-line"></i> 导出
                        </button>
                        <button class="btn" :class="serverLogsConnected ? 'btn--danger' : 'btn--primary'" @click="serverLogsConnected ? disconnectServerLogs() : connectServerLogs()">
                            <i class="btn-icon" :class="serverLogsConnected ? 'ri-stop-circle-line' : 'ri-play-circle-line'"></i>
                            {{ serverLogsConnected ? '断开' : '连接' }}
                        </button>
                    </div>
                </div>

                <div class="server-logs-container">
                    <div class="server-logs-content" ref="serverLogsContainer" @scroll="handleServerLogsScroll">
                        <div v-if="filteredServerLogs.length === 0" class="server-logs-empty">
                            <i class="ri-terminal-box-line"></i>
                            <p v-if="!serverLogsConnected">点击"连接"按钮开始接收实时日志</p>
                            <p v-else-if="serverLogsFilter || serverLogsLevel !== 'all'">没有匹配的日志</p>
                            <p v-else>等待日志输出...</p>
                        </div>
                        <div v-else class="server-logs-list">
                            <div v-for="(log, index) in filteredServerLogs" :key="index" class="server-log-line" :class="getLogLevelClass(log.level)">
                                <span class="log-time">{{ formatLogTimestamp(log.timestamp) }}</span>
                                <span class="log-level" :class="getLogLevelClass(log.level)">{{ log.level ? log.level.toUpperCase() : 'LOG' }}</span>
                                <span class="log-source" v-if="log.source">[{{ log.source }}]</span>
                                <span class="log-message" v-html="highlightLogMessage(log.message)"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 面板: Chat 会话 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'chat'}">
                <div class="chat-container">
                    <!-- Chat 侧边栏 -->
                    <aside class="chat-sidebar">
                        <div class="chat-sidebar-header">
                            <button class="btn btn--primary" style="width: 100%; margin-bottom: 8px;" @click="handleCreateChatSession">
                                <i class="btn-icon ri-add-line"></i> 新建会话
                            </button>
                            <button class="btn btn--secondary" style="width: 100%;" @click="handleClearAllChatSessions" v-if="chatSessions.length > 0">
                                <i class="btn-icon ri-delete-bin-line"></i> 清空所有会话
                            </button>
                        </div>
                        <div class="chat-sessions">
                            <div
                                v-for="session in chatSessions"
                                :key="session.id"
                                class="chat-session-item"
                                :class="{'is-active': chatActiveSessionId === session.id}">
                                <div class="chat-session-info" @click="handleLoadChatSession(session.id)">
                                    <div class="chat-session-title">{{ session.title }}</div>
                                    <div class="chat-session-date">{{ formatChatDate(session.date) }}</div>
                                </div>
                                <button class="chat-session-delete" @click.stop="handleDeleteChatSession(session.id)" data-tooltip="删除会话">
                                    <i class="ri-delete-bin-line" style="font-size: 14px;"></i>
                                </button>
                            </div>
                        </div>
                    </aside>

                    <!-- Chat 主区 -->
                    <div class="chat-main">
                        <div class="chat-header">
                            <div style="display: flex; align-items: center; gap: 20px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label style="color: var(--color-text-secondary); font-size: 12px; font-weight: 500;">模型</label>
                                    <div class="custom-select" :class="{ 'is-open': modelSelectOpen }">
                                        <div class="custom-select-trigger" @click="modelSelectOpen = !modelSelectOpen">
                                            <span>{{ chatModel || '加载中...' }}</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </div>
                                        <div class="custom-select-options" v-show="modelSelectOpen">
                                            <div v-for="model in chatModels" :key="model.id"
                                                 class="custom-select-option"
                                                 :class="{ 'is-selected': chatModel === model.id }"
                                                 @click="selectModel(model.id)"
                                                 :data-tooltip="model.description">
                                                {{ model.name }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Think Mode 状态显示 -->
                                <span v-if="isThinkModeEnabled" class="think-mode-badge" data-tooltip="深度思考模式已启用">
                                    <i class="ri-brain-line"></i> Think
                                </span>
                            </div>
                            <button class="btn btn--secondary" @click="handleClearChatSession">
                                <i class="btn-icon ri-delete-bin-line"></i> 清空
                            </button>
                        </div>

                        <div class="chat-messages" ref="chatMessagesContainer">
                            <div v-if="chatCurrentSession && chatCurrentSession.messages.length === 0" class="empty-state">
                                <i class="empty-state-icon ri-chat-smile-2-line"></i>
                                <p>开始一个新的对话</p>
                            </div>
                            <div v-else v-for="(message, index) in chatMessages" :key="index"
                                 class="chat-message"
                                 :class="{'chat-message--user': message.role === 'user', 'chat-message--assistant': message.role === 'assistant'}">
                                <div class="chat-message-avatar"
                                     :class="message.role === 'user' ? 'chat-message-avatar--user' : 'chat-message-avatar--ai'">
                                    <i :class="message.role === 'user' ? 'ri-user-line' : 'ri-robot-line'"></i>
                                </div>
                                <div class="chat-message-body">
                                    <div class="chat-message-meta">
                                        <span class="chat-message-author">{{ message.role === 'user' ? '我' : 'AI 助手' }}</span>
                                        <div class="chat-message-tags">
                                            <span class="chat-tag" :class="message.role === 'user' ? 'chat-tag--user' : 'chat-tag--ai'">
                                                {{ message.role === 'user' ? '手动输入' : '智能回复' }}
                                            </span>
                                            <span class="chat-tag chat-tag--status" v-if="message.role === 'assistant' && message.isThinking">流式生成中</span>
                                            <span class="chat-tag chat-tag--ghost" v-else-if="message.role === 'assistant'">已完成</span>
                                        </div>
                                    </div>
                                    <!-- Thinking Block (for AI messages with think mode) -->
                                    <div v-if="message.role === 'assistant' && message.hasThinking && (message.isThinking || (message.thinking && message.thinking.length > 0))" class="thinking-block">
                                        <div class="thinking-header" @click="toggleThinkingBlock(message)">
                                            <i class="ri-lightbulb-line"></i>
                                            <span v-if="message.isThinking">Thinking...</span>
                                            <span v-else>Thought process</span>
                                            <div v-if="message.isThinking" class="thinking-inline-spinner">
                                                <div class="spinner-dot"></div>
                                                <div class="spinner-dot"></div>
                                                <div class="spinner-dot"></div>
                                            </div>
                                            <i v-if="!message.isThinking" class="thinking-expand-icon" :class="message.thinkingExpanded ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                        </div>
                                        <!-- Thinking content (streaming) -->
                                        <div v-if="message.thinking" class="thinking-content" v-show="message.thinkingExpanded">
                                            <div class="thinking-text">{{ message.thinking }}</div>
                                        </div>
                                    </div>
                                    <!-- eslint-disable-next-line vue/no-v-html -->
                                    <div class="chat-message-content" v-if="message.showAnswer !== false" v-html="renderChatMarkdown(message.content)"></div>
                                    <!-- AI消息操作按钮 -->
                                    <div class="chat-message-actions" v-if="message.role === 'assistant' && !message.isThinking">
                                        <button class="chat-message-action-btn" @click="handleCopyMessage(message.content, false)" data-tooltip="复制内容">
                                            <i class="ri-file-copy-line"></i> 复制
                                        </button>
                                        <button class="chat-message-action-btn" @click="handleCopyMessage(message.content, true)" data-tooltip="复制Markdown格式">
                                            <i class="ri-markdown-line"></i> 复制MD
                                        </button>
                                        <button class="chat-message-action-btn" @click="handleRetryAssistantMessage(index)" data-tooltip="重新生成回答">
                                            <i class="ri-refresh-line"></i> 重试
                                        </button>
                                    </div>
                                    <!-- 用户消息重试按钮 -->
                                    <div class="chat-message-actions" v-if="message.role === 'user' && index === chatMessages.length - 1">
                                        <button class="chat-message-action-btn" @click="handleRetryMessage()" data-tooltip="重新发送">
                                            <i class="ri-refresh-line"></i> 重试
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input-container">
                            <div class="chat-input-wrapper" :class="{'is-streaming': chatStreaming}">
                                <textarea
                                    class="chat-input"
                                    v-model="chatInputText"
                                    @keydown.ctrl.enter="handleSendChatMessage"
                                    placeholder="输入消息... (Ctrl+Enter 发送)"
                                    rows="2"></textarea>
                                <div class="chat-input-actions">
                                    <span style="font-size: 11px; color: var(--color-text-secondary);">支持 Markdown</span>
                                    <button class="btn btn--secondary" v-if="chatStreaming" @click="handleStopStreaming">
                                        <i class="btn-icon ri-stop-circle-line"></i> 停止
                                    </button>
                                    <button class="btn btn--primary" :disabled="chatStreaming" @click="handleSendChatMessage">
                                        <i class="btn-icon ri-send-plane-fill"></i> 发送
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 面板: 开发工具配置 -->
            <section class="tab-panel" :class="{'is-active': activeTab === 'devtools'}">
                <div class="page-header">
                    <h2 class="page-header-title">开发工具配置</h2>
                </div>
                <div class="devtools-content">
                    <!-- Claude Code 配置卡片 -->
                    <div class="devtools-card">
                        <div class="devtools-card-header">
                            <div class="devtools-card-title">
                                <i class="ri-terminal-box-line"></i>
                                Claude Code 配置
                            </div>
                            <span class="devtools-status" :class="claudeCodeConfig.configured ? 'devtools-status--success' : 'devtools-status--warning'">
                                <i :class="claudeCodeConfig.configured ? 'ri-checkbox-circle-fill' : 'ri-error-warning-fill'"></i>
                                {{ claudeCodeConfig.configured ? '已配置' : '未配置' }}
                            </span>
                        </div>
                        <div class="devtools-card-body">
                            <div class="devtools-form-group">
                                <label class="devtools-label">Base URL</label>
                                <input type="text" class="devtools-input" v-model="claudeCodeConfig.baseUrl" placeholder="http://127.0.0.1:62311">
                            </div>
                            <div class="devtools-form-group">
                                <label class="devtools-label">API Key</label>
                                <input type="text" class="devtools-input" v-model="claudeCodeConfig.apiKey" placeholder="输入 API Key">
                            </div>
                            <div class="devtools-actions">
                                <button class="btn btn--primary" @click="saveClaudeCodeConfig" :disabled="claudeCodeConfig.saving">
                                    <i class="btn-icon" :class="claudeCodeConfig.saving ? 'ri-loader-4-line is-spinning' : 'ri-save-line'"></i>
                                    {{ claudeCodeConfig.saving ? '保存中...' : '一键配置' }}
                                </button>
                                <button class="btn btn--secondary" @click="loadClaudeCodeConfig" :disabled="claudeCodeConfig.loading">
                                    <i class="btn-icon" :class="claudeCodeConfig.loading ? 'ri-loader-4-line is-spinning' : 'ri-refresh-line'"></i>
                                    刷新
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Droid 配置卡片（暂时隐藏） -->
                    <div class="devtools-card" style="display: none;">
                        <div class="devtools-card-header">
                            <div class="devtools-card-title">
                                <i class="ri-android-line"></i>
                                Droid 配置
                            </div>
                            <span class="devtools-status" :class="droidConfig.configured ? 'devtools-status--success' : 'devtools-status--warning'">
                                <i :class="droidConfig.configured ? 'ri-checkbox-circle-fill' : 'ri-error-warning-fill'"></i>
                                {{ droidConfig.configured ? '已配置' : '未配置' }}
                            </span>
                        </div>
                        <div class="devtools-card-body">
                            <div class="devtools-form-group">
                                <label class="devtools-label">Base URL</label>
                                <input type="text" class="devtools-input" v-model="droidConfig.baseUrl" placeholder="http://127.0.0.1:62311">
                            </div>
                            <div class="devtools-form-group">
                                <label class="devtools-label">API Key</label>
                                <input type="text" class="devtools-input" v-model="droidConfig.apiKey" placeholder="输入 API Key">
                            </div>
                            <div class="devtools-actions">
                                <button class="btn btn--primary" @click="saveDroidConfig" :disabled="droidConfig.saving">
                                    <i class="btn-icon" :class="droidConfig.saving ? 'ri-loader-4-line is-spinning' : 'ri-save-line'"></i>
                                    {{ droidConfig.saving ? '保存中...' : '一键配置' }}
                                </button>
                                <button class="btn btn--secondary" @click="loadDroidConfig" :disabled="droidConfig.loading">
                                    <i class="btn-icon" :class="droidConfig.loading ? 'ri-loader-4-line is-spinning' : 'ri-refresh-line'"></i>
                                    刷新
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 配置说明卡片 -->
                    <div class="devtools-card">
                        <div class="devtools-card-header">
                            <div class="devtools-card-title">
                                <i class="ri-book-open-line"></i>
                                配置说明
                            </div>
                        </div>
                        <div class="devtools-card-body">
                            <div class="devtools-info">
                                <p><strong>Claude Code</strong> 是 Anthropic 官方的 CLI 工具。通过配置 Base URL，可以将请求转发到本服务。</p>
                                <p><a href="https://docs.anthropic.com/en/docs/claude-code/overview" target="_blank" style="color: var(--color-accent-primary);">官方文档 &rarr;</a></p>

                                <h4>配置文件位置</h4>
                                <ul>
                                    <li><strong>Mac / Linux:</strong> <code>~/.claude/settings.json</code></li>
                                    <li><strong>Windows:</strong> <code>%USERPROFILE%\.claude\settings.json</code></li>
                                </ul>

                                <h4>手动配置方法</h4>
                                <p>在配置文件中添加以下内容：</p>
                                <pre class="devtools-code">{
  "env": {
    "ANTHROPIC_BASE_URL": "{{ claudeCodeConfig.baseUrl || getDefaultBaseUrl() }}",
    "ANTHROPIC_AUTH_TOKEN": "your-api-key"
  }
}</pre>

                                <h4>注意事项</h4>
                                <ul>
                                    <li>配置后需要重启 Claude Code 才能生效</li>
                                    <li>API Key 可以是任意字符串，用于身份验证</li>
                                    <li>确保本服务正在运行且端口可访问</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- ==================== 底部 ==================== -->
        <footer class="app-footer" :class="{'layout-centered': !settingsData.layoutFullWidth}">
            <span class="footer-online">
                <i class="ri-user-line"></i> 当前在线: <strong>{{ onlineCount }}</strong> 人
            </span>
            <span class="footer-divider">|</span>
            <span class="footer-latency" :class="getAwsLatencyClass()" @click="checkAwsLatency" data-tooltip="点击重新检测">
                <span class="latency-dot"></span>
                <span>AWS 延迟: <strong>{{ getAwsLatencyText() }}</strong></span>
                <i v-if="awsLatencyChecking" class="ri-loader-4-line is-spinning"></i>
            </span>
        </footer>

        <!-- ==================== Toast 通知 ==================== -->
        <transition name="toast">
            <div v-if="toastVisible" class="toast" :class="`toast--${toastType}`">
                <i :class="getToastIconClass()"></i>
                <span>{{ toastMessage }}</span>
            </div>
        </transition>

        <!-- ==================== 版本详情弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showVersionModal}" @click.self="closeVersionModal">
            <div class="modal version-modal">
                <div class="modal-header">
                    <h3><i :class="editionIcon"></i> 版本信息</h3>
                    <button class="modal-close-btn" @click="closeVersionModal">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- 当前版本信息 -->
                    <div class="version-current">
                        <div class="version-current-header">
                            <span :class="editionBadgeClass + ' large'">
                                <i :class="editionIcon"></i>
                                {{ editionDisplayName }}
                            </span>
                        </div>
                        <div class="version-quota-info">
                            <div class="version-quota-label">账号配额使用情况</div>
                            <div class="version-quota-bar">
                                <div class="version-quota-fill" :style="{width: accountQuotaPercent + '%'}" :class="{'near-limit': isNearQuotaLimit, 'at-limit': isAtQuotaLimit}"></div>
                            </div>
                            <div class="version-quota-text">
                                <span>已使用 {{ settingsData.currentAccountCount }} / {{ settingsData.maxAccounts }} 个账号</span>
                                <span :class="{'text-warning': isNearQuotaLimit, 'text-danger': isAtQuotaLimit}">{{ accountQuotaPercent }}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 版本对比表格 -->
                    <div class="version-compare">
                        <h4>版本对比</h4>
                        <table class="version-table">
                            <thead>
                                <tr>
                                    <th>版本</th>
                                    <th>账号</th>
                                    <th>说明</th>
                                    <th>购买</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr :class="{'current-edition': settingsData.edition === 'free'}">
                                    <td><span class="edition-badge edition-badge--free small"><i class="ri-user-line"></i> Free</span></td>
                                    <td>1 个</td>
                                    <td>体验试用</td>
                                    <td>-</td>
                                </tr>
                                <tr :class="{'current-edition': settingsData.edition === 'pro'}">
                                    <td><span class="edition-badge edition-badge--pro small"><i class="ri-medal-line"></i> Pro</span></td>
                                    <td>10 个</td>
                                    <td>正常用量</td>
                                    <td><a href="https://pay.ldxp.cn/shop/XM3L94VA" target="_blank" class="btn btn--small btn--primary"><i class="ri-shopping-bag-3-line"></i> 购买</a></td>
                                </tr>
                                <tr :class="{'current-edition': settingsData.edition === 'promax'}">
                                    <td><span class="edition-badge edition-badge--promax small"><i class="ri-flashlight-line"></i> Pro Max</span></td>
                                    <td>30 个</td>
                                    <td>大用量</td>
                                    <td><a href="https://pay.ldxp.cn/shop/XM3L94VA" target="_blank" class="btn btn--small btn--primary"><i class="ri-shopping-bag-3-line"></i> 购买</a></td>
                                </tr>
                                <tr :class="{'current-edition': settingsData.edition === 'ultra'}">
                                    <td><span class="edition-badge edition-badge--ultra small"><i class="ri-vip-crown-2-fill"></i> Ultra</span></td>
                                    <td>100 个</td>
                                    <td>超大用量</td>
                                    <td><a href="https://pay.ldxp.cn/shop/XM3L94VA" target="_blank" class="btn btn--small btn--primary"><i class="ri-shopping-bag-3-line"></i> 购买</a></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="version-notes" style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 6px; padding: 10px 12px; margin-top: 16px;">
                            <p style="margin: 0 0 6px 0; color: #f59e0b; font-weight: 500; font-size: 12px;"><i class="ri-information-line" style="margin-right: 4px;"></i>购买说明</p>
                            <ul style="margin: 0; padding-left: 16px; font-size: 12px; color: var(--color-text-secondary); line-height: 1.8;">
                                <li>购买后将获得激活码，在上方输入激活码即可解锁对应版本功能</li>
                                <li>账号配额仅限制同时存在的账号数量，可删除旧账号后添加新账号，无使用次数限制</li>
                                <li>一个激活码只能激活一台设备，第二台设备半价</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 升级说明 -->
                    <div class="version-upgrade" v-if="settingsData.edition !== 'ultra'">
                        <div class="version-upgrade-icon">
                            <i class="ri-rocket-line"></i>
                        </div>
                        <div class="version-upgrade-content">
                            <h4>需要更多账号配额？</h4>
                            <p><a href="https://pay.ldxp.cn/shop/XM3L94VA" target="_blank" style="color: var(--color-primary); text-decoration: none;">点击购买激活码</a>，支付后获取激活码激活即可升级</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--primary" @click="closeVersionModal">
                        <i class="ri-check-line"></i> 我知道了
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 添加账号提示弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showAddAccountTipModal}">
            <div class="modal add-account-tip-modal">
                <div class="modal-header">
                    <h3><i class="ri-lightbulb-flash-line"></i> 添加账号须知</h3>
                </div>
                <div class="modal-body">
                    <div class="tip-content">
                        <div class="tip-icon">
                            <i class="ri-information-line"></i>
                        </div>
                        <div class="tip-list">
                            <div class="tip-item">
                                <div class="tip-number">1</div>
                                <div class="tip-text">
                                    <strong>优先使用直连方式</strong>
                                    <p>请优先使用直连方式添加账号，确保连接稳定性</p>
                                </div>
                            </div>
                            <div class="tip-item">
                                <div class="tip-number">2</div>
                                <div class="tip-text">
                                    <strong>检查账号状态</strong>
                                    <p>添加成功后查看「使用率」是否正常显示，正常即为可用；若显示「封控」则该账号不可用，可直接删除</p>
                                </div>
                            </div>
                            <div class="tip-item">
                                <div class="tip-number">3</div>
                                <div class="tip-text">
                                    <strong>使用无痕模式</strong>
                                    <p>每次添加账号请使用<strong>无痕浏览器</strong>打开，添加完成后<strong>关闭所有窗口</strong>，再重新打开添加下一个账号</p>
                                </div>
                            </div>
                        </div>
                        <div class="tip-warning">
                            <i class="ri-error-warning-line"></i>
                            <span>遵循以上步骤可有效避免账号被封控风险</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--primary" @click="closeAddAccountTipAndContinue">
                        <i class="ri-check-line"></i>
                        <span>我已知晓，继续添加</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 测试模式密码弹窗 ==================== -->
        <div class="modal-overlay modal-overlay--top" :class="{active: showTestPasswordModal}" @click.self="cancelTestPassword" @keydown.enter="confirmTestPassword" @keydown.esc="cancelTestPassword">
            <div class="modal license-modal" style="max-width: 400px;">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(220, 38, 38, 0.06) 100%);">
                    <h3><i class="ri-lock-password-line" style="color: var(--color-danger);"></i> 操作验证</h3>
                    <button class="modal-close-btn" @click="cancelTestPassword">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div style="text-align: center; margin-bottom: 16px;">
                        <div style="width: 56px; height: 56px; margin: 0 auto 12px; border-radius: 50%; background: rgba(239, 68, 68, 0.1); display: flex; align-items: center; justify-content: center;">
                            <i class="ri-shield-keyhole-line" style="font-size: 28px; color: var(--color-danger);"></i>
                        </div>
                        <p style="font-size: 14px; color: var(--color-text-secondary); margin: 0;">
                            当前为测试模式，执行 <strong style="color: var(--color-text-primary);">{{ testPasswordAction }}</strong> 操作需要验证密码
                        </p>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">操作密码</label>
                        <input 
                            type="password" 
                            class="form-input" 
                            v-model="testPasswordInput" 
                            placeholder="请输入操作密码" 
                            autofocus
                            @keydown.enter="confirmTestPassword"
                        >
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="cancelTestPassword">取消</button>
                    <button class="btn btn--primary" @click="confirmTestPassword" :disabled="!testPasswordInput">
                        <i class="ri-check-line"></i> 确认
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 退出确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showLogoutModal}" @click.self="showLogoutModal = false">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper">
                            <i class="ri-logout-box-r-line"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认退出登录</h3>
                            <p>退出后需要重新输入密码才能访问管理中心</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="showLogoutModal = false">取消</button>
                    <button class="btn btn--primary" @click="confirmLogout">
                        <i class="ri-logout-box-r-line"></i> 确认退出
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 清空会话确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showClearSessionModal}" @click.self="closeClearSessionConfirm">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认清空会话</h3>
                            <p>清空后当前会话的所有消息将被删除</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeClearSessionConfirm">取消</button>
                    <button class="btn btn--primary" @click="confirmClearChatSession" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认清空
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 删除会话确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showDeleteSessionModal}" @click.self="closeDeleteSessionConfirm">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认删除会话</h3>
                            <p>删除后该会话的所有消息将被永久删除</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeDeleteSessionConfirm">取消</button>
                    <button class="btn btn--primary" @click="confirmDeleteChatSession(deleteSessionId)" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 清空所有会话确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showClearAllSessionsModal}" @click.self="closeClearAllSessionsConfirm">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认清空所有会话</h3>
                            <p>清空后所有会话的消息将被永久删除，此操作不可撤销</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeClearAllSessionsConfirm">取消</button>
                    <button class="btn btn--primary" @click="confirmClearAllChatSessions" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认清空
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== OAuth 授权弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showOAuthModal}" @click.self="closeOAuthModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <!-- 头部：图标 + 标题描述 -->
                        <div class="oauth-header">
                            <div class="oauth-icon-wrapper" :class="{
                                waiting: oauthStatus === 'waiting',
                                success: oauthStatus === 'success'
                            }">
                                <i :class="oauthStatus === 'success' ? 'ri-checkbox-circle-line' : 'ri-user-add-line'"></i>
                            </div>
                            <div class="oauth-header-text">
                                <h3 class="oauth-title">{{ oauthTitle }}</h3>
                                <p class="oauth-description">{{ oauthDescription }}</p>
                            </div>
                        </div>

                        <!-- 操作步骤 -->
                        <div class="oauth-steps" v-if="oauthStatus !== 'success'">
                            <div class="oauth-step">
                                <div class="oauth-step-number">1</div>
                                <div class="oauth-step-text">
                                    <div class="oauth-step-title">打开授权页面</div>
                                    <div class="oauth-copy-box" v-if="oauthUrl">
                                        <input type="text" :value="oauthUrl" readonly class="oauth-url-input" @click="$event.target.select()">
                                        <button class="btn btn--small btn--secondary" @click="copyOAuthUrl" data-tooltip="复制链接">
                                            <i class="ri-file-copy-line"></i>
                                        </button>
                                    </div>
                                    <div class="oauth-tip" v-if="oauthUrl">
                                        <i class="ri-incognito-line"></i> 推荐：复制链接在<strong>无痕模式/隐私窗口</strong>中打开
                                    </div>
                                </div>
                            </div>
                            <div class="oauth-step">
                                <div class="oauth-step-number">2</div>
                                <div class="oauth-step-text">
                                    <div class="oauth-step-title">使用临时邮箱完成注册和验证</div>
                                    <div class="oauth-copy-box">
                                        <input type="text" value="https://tempmail.hk/zh" readonly class="oauth-url-input" @click="$event.target.select()">
                                        <button class="btn btn--small btn--secondary" @click="copyTempMailUrl" data-tooltip="复制链接">
                                            <i class="ri-file-copy-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="oauth-step">
                                <div class="oauth-step-number">3</div>
                                <div class="oauth-step-text">授权完成后账号将自动添加</div>
                            </div>
                        </div>

                        <!-- 状态提示 -->
                        <div class="oauth-status" :class="{
                            waiting: oauthStatus === 'waiting',
                            success: oauthStatus === 'success'
                        }">
                            <div class="oauth-spinner" v-if="oauthStatus === 'waiting'"></div>
                            <i class="ri-checkbox-circle-line" v-if="oauthStatus === 'success'"></i>
                            <span>{{ oauthStatusText }}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeOAuthModal">
                        {{ oauthStatus === 'success' ? '完成' : '取消' }}
                    </button>
                    <button class="btn btn--primary" @click="reopenOAuthWindows" v-if="oauthStatus === 'waiting'">
                        <i class="ri-external-link-line"></i> 重新打开窗口
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 导入账号弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showImportModal}" @click.self="closeImportModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <!-- 图标 -->
                        <div class="oauth-icon-wrapper" :class="{
                            waiting: importStatus === 'importing',
                            success: importStatus === 'success',
                            error: importStatus === 'error'
                        }">
                            <i v-if="importStatus === 'idle'" class="ri-upload-cloud-line"></i>
                            <i v-if="importStatus === 'importing'" class="ri-loader-4-line oauth-spinner-icon"></i>
                            <i v-if="importStatus === 'success'" class="ri-checkbox-circle-line"></i>
                            <i v-if="importStatus === 'error'" class="ri-error-warning-line"></i>
                        </div>

                        <!-- 标题和描述 -->
                        <h3 class="oauth-title">{{ importTitle }}</h3>
                        <p class="oauth-description">{{ importDescription }}</p>

                        <!-- 导入进度信息 -->
                        <div class="import-progress-info" v-if="importStatus === 'importing' || importStatus === 'success' || importStatus === 'error'">
                            <div class="import-stats">
                                <div class="import-stat-item success">
                                    <div class="import-stat-number">{{ importSuccessCount }}</div>
                                    <div class="import-stat-label">成功</div>
                                </div>
                                <div class="import-stat-divider"></div>
                                <div class="import-stat-item error">
                                    <div class="import-stat-number">{{ importFailCount }}</div>
                                    <div class="import-stat-label">失败</div>
                                </div>
                                <div class="import-stat-divider"></div>
                                <div class="import-stat-item total">
                                    <div class="import-stat-number">{{ importTotalCount }}</div>
                                    <div class="import-stat-label">总计</div>
                                </div>
                            </div>

                            <!-- 进度条 -->
                            <div class="import-progress-bar" v-if="importStatus === 'importing'">
                                <div class="import-progress-fill" :style="{width: importProgressPercent + '%'}"></div>
                            </div>
                        </div>

                        <!-- 状态提示 -->
                        <div class="oauth-status" :class="{
                            waiting: importStatus === 'importing',
                            success: importStatus === 'success',
                            error: importStatus === 'error'
                        }">
                            <div class="oauth-spinner" v-if="importStatus === 'importing'"></div>
                            <i class="ri-checkbox-circle-line" v-if="importStatus === 'success'"></i>
                            <i class="ri-error-warning-line" v-if="importStatus === 'error'"></i>
                            <span>{{ importStatusText }}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeImportModal" v-if="importStatus !== 'importing'">
                        {{ importStatus === 'success' ? '完成' : '关闭' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== Token 导入弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showTokenImportModal}" @click.self="closeTokenImportModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <!-- 图标 -->
                        <div class="oauth-icon-wrapper" :class="{
                            waiting: tokenImportStatus === 'importing',
                            success: tokenImportStatus === 'success',
                            error: tokenImportStatus === 'error'
                        }">
                            <i v-if="tokenImportStatus === 'idle'" class="ri-key-2-line"></i>
                            <i v-if="tokenImportStatus === 'importing'" class="ri-loader-4-line oauth-spinner-icon"></i>
                            <i v-if="tokenImportStatus === 'success'" class="ri-checkbox-circle-line"></i>
                            <i v-if="tokenImportStatus === 'error'" class="ri-error-warning-line"></i>
                        </div>

                        <!-- 标题和描述 -->
                        <h3 class="oauth-title">{{ tokenImportTitle }}</h3>
                        <p class="oauth-description">{{ tokenImportDescription }}</p>

                        <!-- 导入进度信息 -->
                        <div class="import-progress-info" v-if="tokenImportStatus === 'importing' || tokenImportStatus === 'success' || tokenImportStatus === 'error'">
                            <div class="import-stats">
                                <div class="import-stat-item success">
                                    <div class="import-stat-number">{{ tokenImportSuccessCount }}</div>
                                    <div class="import-stat-label">成功</div>
                                </div>
                                <div class="import-stat-divider"></div>
                                <div class="import-stat-item warning">
                                    <div class="import-stat-number">{{ tokenImportDuplicateCount }}</div>
                                    <div class="import-stat-label">重复</div>
                                </div>
                                <div class="import-stat-divider"></div>
                                <div class="import-stat-item error">
                                    <div class="import-stat-number">{{ tokenImportFailCount }}</div>
                                    <div class="import-stat-label">失败</div>
                                </div>
                                <div class="import-stat-divider"></div>
                                <div class="import-stat-item total">
                                    <div class="import-stat-number">{{ tokenImportTotalCount }}</div>
                                    <div class="import-stat-label">总计</div>
                                </div>
                            </div>
                        </div>

                        <!-- 状态提示 -->
                        <div class="oauth-status" :class="{
                            waiting: tokenImportStatus === 'importing',
                            success: tokenImportStatus === 'success',
                            error: tokenImportStatus === 'error'
                        }">
                            <div class="oauth-spinner" v-if="tokenImportStatus === 'importing'"></div>
                            <i class="ri-checkbox-circle-line" v-if="tokenImportStatus === 'success'"></i>
                            <i class="ri-error-warning-line" v-if="tokenImportStatus === 'error'"></i>
                            <span>{{ tokenImportStatusText }}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeTokenImportModal" v-if="tokenImportStatus !== 'importing'">
                        {{ tokenImportStatus === 'success' ? '完成' : '关闭' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 删除账号确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showDeleteModal}" @click.self="closeDeleteModal" @keydown.enter="confirmDelete" @keydown.esc="closeDeleteModal" tabindex="-1">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认删除账号</h3>
                            <p>确定要删除 <strong>{{ deleteAccountLabel }}</strong> 吗?此操作不可撤销</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeDeleteModal">取消</button>
                    <button class="btn btn--primary" @click="confirmDelete" ref="deleteConfirmBtn" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 删除封控账号确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showDeleteSuspendedModal}" @click.self="closeDeleteSuspendedModal" @keydown.esc="closeDeleteSuspendedModal" tabindex="-1">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-shield-cross-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认删除封控账号</h3>
                            <p>检测到 <strong>{{ suspendedAccountCount }}</strong> 个封控账号，确定要全部删除吗？此操作不可撤销</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeDeleteSuspendedModal">取消</button>
                    <button class="btn btn--primary" @click="confirmDeleteSuspended" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 账号日志弹窗（紧凑列表） ==================== -->
        <div class="modal-overlay" :class="{active: showAccountLogsModal}" @click.self="closeAccountLogsModal">
            <div class="modal compact-logs-modal">
                <!-- 弹窗头部 -->
                <div class="compact-logs-header">
                    <div class="compact-logs-title">
                        <span class="compact-account-id">#{{ getAccountShortId(currentViewAccountId) }}</span>
                        <span class="compact-account-label" v-if="currentViewAccountLabel">{{ currentViewAccountLabel }}</span>
                        <span class="compact-logs-count">{{ accountLogsTotal }} 条</span>
                    </div>
                    <div class="compact-logs-actions">
                        <span class="compact-auto-refresh" v-if="accountLogsAutoRefresh">
                            <i class="ri-refresh-line spin-animation"></i> 自动刷新中
                        </span>
                        <button class="compact-close-btn" @click="closeAccountLogsModal">
                            <i class="ri-close-line"></i>
                        </button>
                    </div>
                </div>

                <!-- 日志列表区 -->
                <div class="compact-logs-body">
                    <!-- 加载状态 -->
                    <div v-if="accountLogsLoading && accountLogs.length === 0" class="compact-logs-loading">
                        <i class="ri-loader-4-line spin-animation"></i>
                    </div>

                    <!-- 空状态 -->
                    <div v-if="!accountLogsLoading && accountLogs.length === 0" class="compact-logs-empty">
                        <i class="ri-inbox-line"></i>
                        <span>暂无日志</span>
                    </div>

                    <!-- 日志列表 -->
                    <div v-if="accountLogs.length > 0" class="compact-logs-list" :class="{'is-loading': accountLogsLoading}">
                        <div v-for="log in accountLogs" :key="log.id" class="compact-log-item" :class="{'is-error': !log.is_success}">
                            <!-- 第一行：左右均匀分布 -->
                            <div class="compact-log-row1">
                                <div class="compact-log-left">
                                    <span class="compact-log-time">{{ formatLogTimeShort(log.timestamp) }}</span>
                                    <span class="compact-log-status" :class="log.is_success ? 'status-ok' : 'status-err'">{{ log.status_code }}</span>
                                    <span class="compact-log-duration">{{ log.duration_ms }}ms</span>
                                </div>
                                <div class="compact-log-right">
                                    <span class="compact-log-method" :class="'m-' + log.method.toLowerCase()">{{ log.method }}</span>
                                    <span class="compact-log-path">{{ log.path }}</span>
                                </div>
                            </div>
                            <!-- 第二行：标签信息 -->
                            <div class="compact-log-row2" v-if="log.model || log.endpoint_type || log.input_tokens || log.output_tokens || log.client_ip">
                                <span class="compact-tag" v-if="log.model"><i class="ri-robot-line"></i>{{ log.model }}</span>
                                <span class="compact-tag" v-if="log.endpoint_type"><i class="ri-plug-line"></i>{{ log.endpoint_type }}</span>
                                <span class="compact-tag" v-if="log.input_tokens || log.output_tokens"><i class="ri-coin-line"></i>{{ (log.input_tokens || 0) + (log.output_tokens || 0) }}t</span>
                                <span class="compact-tag" v-if="log.client_ip"><i class="ri-global-line"></i>{{ log.client_ip }}</span>
                            </div>
                            <!-- 错误信息 -->
                            <div class="compact-log-error" v-if="log.error_message">
                                <pre>{{ log.error_message }}</pre>
                            </div>
                        </div>
                    </div>

                    <!-- 分页 -->
                    <div v-if="accountLogsTotal > 0" style="display: flex; justify-content: center; align-items: center; gap: 4px; padding: 10px 0; border-top: 1px solid var(--color-border);">
                        <button class="btn btn--sm btn--secondary" @click="handleAccountLogsPrevPage" :disabled="accountLogsOffset === 0 || accountLogsLoading" style="padding: 4px 6px;">
                            <i class="ri-arrow-left-s-line"></i>
                        </button>
                        <button v-for="page in accountLogsPageNumbers" :key="page"
                                class="btn btn--sm"
                                :class="page === accountLogsCurrentPage ? 'btn--primary' : 'btn--secondary'"
                                @click="handleAccountLogsGoToPage(page)" :disabled="accountLogsLoading"
                                style="min-width: 28px; padding: 4px 6px; font-size: 12px;">
                            {{ page }}
                        </button>
                        <button class="btn btn--sm btn--secondary" @click="handleAccountLogsNextPage" :disabled="accountLogs.length < accountLogsLimit || accountLogsLoading" style="padding: 4px 6px;">
                            <i class="ri-arrow-right-s-line"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== 导入备份弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showBackupImportModal}" @click.self="closeBackupImportModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <!-- 图标 -->
                        <div class="oauth-icon-wrapper" :class="{
                            waiting: backupImportStatus === 'importing',
                            success: backupImportStatus === 'success',
                            error: backupImportStatus === 'error'
                        }">
                            <i v-if="backupImportStatus === 'idle' || backupImportStatus === 'confirm'" class="ri-database-2-line"></i>
                            <i v-if="backupImportStatus === 'importing'" class="ri-loader-4-line oauth-spinner-icon"></i>
                            <i v-if="backupImportStatus === 'success'" class="ri-checkbox-circle-line"></i>
                            <i v-if="backupImportStatus === 'error'" class="ri-error-warning-line"></i>
                        </div>

                        <!-- 标题和描述 -->
                        <h3 class="oauth-title">{{ backupImportTitle }}</h3>
                        <p class="oauth-description">{{ backupImportDescription }}</p>

                        <!-- 警告提示 -->
                        <div class="oauth-steps" v-if="backupImportStatus === 'confirm'" style="background: rgba(217, 119, 87, 0.08); border-color: rgba(217, 119, 87, 0.2);">
                            <div class="oauth-step">
                                <div class="oauth-step-number" style="background: var(--color-danger);">!</div>
                                <div class="oauth-step-text" style="color: var(--color-danger); font-weight: 600;">导入备份将会覆盖所有现有数据，包括账号和系统设置</div>
                            </div>
                            <div class="oauth-step">
                                <div class="oauth-step-number" style="background: var(--color-warning);">!</div>
                                <div class="oauth-step-text" style="color: var(--color-text-primary);">请确保你已经备份了当前数据</div>
                            </div>
                            <div class="oauth-step">
                                <div class="oauth-step-number" style="background: var(--color-accent-primary);">i</div>
                                <div class="oauth-step-text">确认导入后，页面将自动刷新</div>
                            </div>
                        </div>

                        <!-- 状态提示 -->
                        <div class="oauth-status" :class="{
                            waiting: backupImportStatus === 'importing',
                            success: backupImportStatus === 'success',
                            error: backupImportStatus === 'error'
                        }" v-if="backupImportStatus !== 'idle'">
                            <div class="oauth-spinner" v-if="backupImportStatus === 'importing'"></div>
                            <i class="ri-checkbox-circle-line" v-if="backupImportStatus === 'success'"></i>
                            <i class="ri-error-warning-line" v-if="backupImportStatus === 'error'"></i>
                            <span>{{ backupImportStatusText }}</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeBackupImportModal" v-if="backupImportStatus !== 'importing'">
                        {{ backupImportStatus === 'success' ? '完成' : '取消' }}
                    </button>
                    <button class="btn btn--primary" @click="confirmBackupImport" v-if="backupImportStatus === 'confirm'" style="background: var(--color-danger);">
                        <i class="ri-checkbox-circle-line"></i> 确认导入
                    </button>
                </div>
            </div>
        </div>
        <!-- ==================== 清理日志确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showCleanupLogsModal}" @click.self="closeCleanupLogsModal">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(217, 161, 87, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-warning);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认清理日志</h3>
                            <p>确定要清理 <strong>{{ settingsData.logRetentionDays }}</strong> 天前的日志吗？此操作不可撤销。</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeCleanupLogsModal">取消</button>
                    <button class="btn btn--primary" @click="confirmCleanupLogs" style="background: var(--color-warning);">
                        <i class="ri-delete-bin-line"></i> 确认清理
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 删除无效账号确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showDeleteIncompleteModal}" @click.self="closeDeleteIncompleteModal">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认删除无效账号</h3>
                            <p>发现 <strong>{{ incompleteAccountCount }}</strong> 个信息不全的账号（缺少 clientId 或 clientSecret），确定要删除吗？</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeDeleteIncompleteModal">取消</button>
                    <button class="btn btn--primary" @click="confirmDeleteIncomplete" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 清除账号统计确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showResetStatsModal}" @click.self="closeResetStatsModal">
            <div class="modal">
                <div class="modal-body">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: rgba(239, 83, 80, 0.1);">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger);"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认清除数据</h3>
                            <p>此操作将：</p>
                            <ul style="margin: 8px 0 0 0; padding-left: 20px; font-size: 13px; color: var(--color-text-secondary);">
                                <li>将所有账号的成功/失败次数归零</li>
                                <li>删除所有请求日志</li>
                            </ul>
                            <p style="margin-top: 8px; color: var(--color-danger); font-size: 12px;"><strong>此操作不可恢复！</strong></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeResetStatsModal">取消</button>
                    <button class="btn btn--primary" @click="confirmResetStats" style="background: var(--color-danger);">
                        <i class="ri-delete-bin-line"></i> 确认清除
                    </button>
                </div>
            </div>
        </div>

        <!-- ==================== 账号导入确认弹窗 ==================== -->
        <div class="modal-overlay" :class="{active: showAccountImportConfirmModal}" @click.self="closeAccountImportConfirmModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <div class="oauth-icon-wrapper" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="ri-upload-cloud-line"></i>
                        </div>
                        <h3 class="oauth-title">确认导入账号</h3>
                        <p class="oauth-description">准备导入 {{ accountImportPreviewCount }} 个账号</p>

                        <div class="oauth-steps">
                            <div class="oauth-step">
                                <div class="oauth-step-icon" style="background: var(--color-accent-primary);">
                                    <i class="ri-bar-chart-line"></i>
                                </div>
                                <div class="oauth-step-text">共 {{ accountImportPreviewCount }} 个账号，有效 {{ accountImportValidCount }} 个</div>
                            </div>
                            <div class="oauth-step" v-if="accountImportDuplicateCount > 0">
                                <div class="oauth-step-icon" style="background: var(--color-warning);">
                                    <i class="ri-error-warning-line"></i>
                                </div>
                                <div class="oauth-step-text" style="color: var(--color-warning);">检测到 {{ accountImportDuplicateCount }} 个重复账号（将自动跳过）</div>
                            </div>
                            <div class="oauth-step">
                                <div class="oauth-step-icon" style="background: var(--color-success);">
                                    <i class="ri-checkbox-circle-line"></i>
                                </div>
                                <div class="oauth-step-text">预计导入 {{ accountImportValidCount - accountImportDuplicateCount }} 个新账号</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeAccountImportConfirmModal">取消</button>
                    <button class="btn btn--primary" @click="confirmAccountImport">
                        <i class="ri-checkbox-circle-line"></i> 确认导入
                    </button>
                </div>
            </div>
        </div>

        <!-- 封禁IP确认弹窗 -->
        <div class="modal-overlay" :class="{active: showBlockIPModal}" @click.self="closeBlockIPModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <div class="oauth-icon-wrapper" style="background: linear-gradient(135deg, #ef5350 0%, #e53935 100%); box-shadow: 0 8px 16px rgba(239, 83, 80, 0.3);">
                            <i class="ri-forbid-line"></i>
                        </div>
                        <h3 class="oauth-title">确认封禁IP</h3>
                        <p class="oauth-description">确定要封禁以下IP地址吗？</p>
                        <div style="padding: 12px; background: var(--color-bg-input); border-radius: 8px; margin: 16px 0;">
                            <code style="font-size: 16px; font-weight: 600; color: var(--color-text-primary);">{{ blockIPTarget }}</code>
                        </div>
                        <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;">封禁后该IP将无法访问系统</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeBlockIPModal">取消</button>
                    <button class="btn btn--danger" @click="confirmBlockIP">
                        <i class="ri-forbid-line"></i> 确认封禁
                    </button>
                </div>
            </div>
        </div>

        <!-- 解封IP确认弹窗 -->
        <div class="modal-overlay" :class="{active: showUnblockIPModal}" @click.self="closeUnblockIPModal">
            <div class="modal oauth-modal">
                <div class="modal-body">
                    <div class="oauth-modal-content">
                        <div class="oauth-icon-wrapper" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); box-shadow: 0 8px 16px rgba(17, 153, 142, 0.3);">
                            <i class="ri-check-line"></i>
                        </div>
                        <h3 class="oauth-title">确认解封IP</h3>
                        <p class="oauth-description">确定要解封以下IP地址吗？</p>
                        <div style="padding: 12px; background: var(--color-bg-input); border-radius: 8px; margin: 16px 0;">
                            <code style="font-size: 16px; font-weight: 600; color: var(--color-text-primary);">{{ unblockIPTarget }}</code>
                        </div>
                        <p style="font-size: 12px; color: var(--color-text-secondary); margin-top: 8px;">解封后该IP可以正常访问系统</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeUnblockIPModal">取消</button>
                    <button class="btn btn--success" @click="confirmUnblockIP">
                        <i class="ri-check-line"></i> 确认解封
                    </button>
                </div>
            </div>
        </div>

        <!-- 添加黑名单弹窗 -->
        <!-- IP配置编辑弹窗 -->
        <div class="modal-overlay" :class="{active: showIPConfigModal}" @click.self="closeIPConfigModal">
            <div class="modal user-modal" style="max-width: 420px;">
                <div class="modal-header">
                    <div class="modal-header-content">
                        <i class="modal-header-icon ri-settings-3-line"></i>
                        <h3>IP配置</h3>
                    </div>
                    <button class="modal-close" @click="closeIPConfigModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="modal-body" v-if="editingIPConfig" style="padding: 16px 20px;">
                    <div style="padding: 10px; background: var(--color-bg-input); border-radius: 6px; margin-bottom: 16px; text-align: center;">
                        <code style="font-size: 14px; font-weight: 600; color: var(--color-accent-primary);">{{ editingIPConfig.ip }}</code>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="ri-sticky-note-line"></i> 备注</label>
                        <input type="text" class="form-input" v-model="ipConfigForm.notes" placeholder="输入备注信息">
                    </div>
                    
                    <div class="form-section-title"><i class="ri-speed-line"></i> 频率限制</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">每分钟请求限制</label>
                            <input type="number" class="form-input" v-model.number="ipConfigForm.rateLimitRPM" min="0" placeholder="0 表示不限制">
                            <small class="form-hint">0 表示不限制</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">每日请求限制</label>
                            <input type="number" class="form-input" v-model.number="ipConfigForm.dailyRequestLimit" min="0" placeholder="0 表示不限制">
                            <small class="form-hint">0 表示不限制</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeIPConfigModal">取消</button>
                    <button class="btn btn--primary" @click="saveIPConfig">
                        <i class="ri-save-line"></i> 保存
                    </button>
                </div>
            </div>
        </div>

        <!-- 日志详情弹窗 -->
        <div class="modal-overlay" :class="{active: showLogDetailModal}" @click.self="handleCloseLogDetail">
            <div class="modal account-logs-modal" style="max-width: 680px;">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <i class="ri-file-list-3-line"></i>
                        请求日志详情
                    </h3>
                    <button class="modal-close" @click="handleCloseLogDetail">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
                <div class="modal-body" v-if="selectedLog" style="max-height: 65vh; overflow-y: auto; padding: 16px;">
                    <div class="log-detail-grid">
                        <div class="log-detail-item">
                            <div class="log-detail-label">请求时间</div>
                            <div class="log-detail-value">{{ formatLogTime(selectedLog.timestamp) }}</div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">客户端IP</div>
                            <div class="log-detail-value"><code>{{ selectedLog.client_ip }}</code></div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">请求方法</div>
                            <div class="log-detail-value"><span class="badge">{{ selectedLog.method }}</span></div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">状态码</div>
                            <div class="log-detail-value">
                                <span class="badge" :class="selectedLog.is_success ? 'badge--success' : 'badge--error'">
                                    {{ selectedLog.status_code }} {{ selectedLog.is_success ? '成功' : '失败' }}
                                </span>
                            </div>
                        </div>
                        <div class="log-detail-item log-detail-item--full">
                            <div class="log-detail-label">请求路径</div>
                            <div class="log-detail-value"><code>{{ selectedLog.path }}</code></div>
                        </div>
                        <div class="log-detail-item" v-if="selectedLog.endpoint_type">
                            <div class="log-detail-label">端点类型</div>
                            <div class="log-detail-value"><span class="badge badge--primary">{{ selectedLog.endpoint_type }}</span></div>
                        </div>
                        <div class="log-detail-item" v-if="selectedLog.model">
                            <div class="log-detail-label">模型</div>
                            <div class="log-detail-value"><code>{{ selectedLog.model }}</code></div>
                        </div>
                        <div class="log-detail-item" v-if="selectedLog.account_id">
                            <div class="log-detail-label">账号ID</div>
                            <div class="log-detail-value"><code>{{ selectedLog.account_id }}</code></div>
                        </div>
                        <div class="log-detail-item" v-if="selectedLog.user_name || selectedLog.user_type">
                            <div class="log-detail-label">用户归属</div>
                            <div class="log-detail-value">
                                <span v-if="selectedLog.user_type === 'admin'" class="user-badge user-badge--admin">
                                    <i class="ri-shield-star-fill"></i>{{ selectedLog.user_name || '管理员' }}
                                </span>
                                <span v-else-if="selectedLog.user_type === 'vip'" class="user-badge user-badge--vip">
                                    <i class="ri-vip-crown-fill"></i>{{ selectedLog.user_name }}
                                </span>
                                <span v-else class="user-badge user-badge--normal">
                                    <i class="ri-user-line"></i>{{ selectedLog.user_name }}
                                </span>
                            </div>
                        </div>
                        <div class="log-detail-item" v-if="selectedLog.is_stream !== null && selectedLog.is_stream !== undefined">
                            <div class="log-detail-label">流式请求</div>
                            <div class="log-detail-value">{{ selectedLog.is_stream ? '是' : '否' }}</div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">请求耗时</div>
                            <div class="log-detail-value">{{ formatDuration(selectedLog.duration_ms) }}</div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">输入Token</div>
                            <div class="log-detail-value">{{ selectedLog.input_tokens }}</div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">输出Token</div>
                            <div class="log-detail-value">{{ selectedLog.output_tokens }}</div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">总Token</div>
                            <div class="log-detail-value"><strong style="color: var(--color-accent-primary);">{{ selectedLog.input_tokens + selectedLog.output_tokens }}</strong></div>
                        </div>
                        <div class="log-detail-item">
                            <div class="log-detail-label">消费金额</div>
                            <div class="log-detail-value"><strong style="color: var(--color-success);">{{ formatCostUSD(selectedLog.cost_usd) }}</strong></div>
                        </div>
                        <div class="log-detail-item log-detail-item--full" v-if="selectedLog.user_agent">
                            <div class="log-detail-label">客户端信息</div>
                            <div class="log-detail-value">
                                <div class="log-ua-tags">
                                    <span class="log-ua-tag"><i class="ri-window-line"></i>{{ parseUserAgent(selectedLog.user_agent).browser }}</span>
                                    <span class="log-ua-tag"><i class="ri-computer-line"></i>{{ parseUserAgent(selectedLog.user_agent).os }}</span>
                                    <span class="log-ua-tag"><i class="ri-smartphone-line"></i>{{ parseUserAgent(selectedLog.user_agent).device }}</span>
                                </div>
                                <details style="margin-top: 8px;">
                                    <summary style="cursor: pointer; font-size: 11px; color: var(--color-text-secondary); user-select: none;">查看原始信息</summary>
                                    <code style="display: block; margin-top: 6px; padding: 8px; background: var(--color-bg-elevated); border-radius: 4px; font-size: 10px; word-break: break-all; line-height: 1.5; color: var(--color-text-secondary);">{{ selectedLog.user_agent }}</code>
                                </details>
                            </div>
                        </div>
                        <div class="log-detail-item log-detail-item--full log-detail-item--error" v-if="selectedLog.error_message">
                            <div class="log-detail-label" style="display: flex; align-items: center; gap: 8px;">
                                <span><i class="ri-error-warning-line"></i> 错误信息</span>
                                <button class="btn btn--icon btn--icon-sm" type="button" style="margin-left: auto;" @click.stop="handleCopyLogErrorMessage(selectedLog.error_message)" data-tooltip="复制错误信息">
                                    <i class="ri-file-copy-line"></i>
                                </button>
                            </div>
                            <div class="log-detail-value" style="white-space: pre-wrap; word-break: break-all;">{{ selectedLog.error_message }}</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="handleCloseLogDetail">关闭</button>
                </div>
            </div>
        </div>

        <!-- 创建用户模态框 -->
        <div class="modal-overlay" :class="{active: showCreateUserModal}" @click.self="closeCreateUserModal">
            <div class="modal user-modal">
                <div class="modal-header">
                    <div class="modal-header-content">
                        <i class="ri-user-add-line modal-header-icon"></i>
                        <h3>新建用户</h3>
                    </div>
                    <button class="modal-close" @click="closeCreateUserModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="modal-body">
                    <div v-if="!newAPIKey">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="ri-user-line"></i>
                                用户名 *
                            </label>
                            <input type="text" class="form-input" v-model="createUserForm.name" placeholder="请输入用户名" autofocus>
                        </div>

                        <div class="form-section-title">
                            <i class="ri-line-chart-line"></i>
                            配额设置
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">日配额 (Token)</label>
                                <input type="number" class="form-input" v-model.number="createUserForm.dailyQuota" min="0" placeholder="0 = 无限制">
                                <small class="form-hint">每日可使用的 Token 数量</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">月配额 (Token)</label>
                                <input type="number" class="form-input" v-model.number="createUserForm.monthlyQuota" min="0" placeholder="0 = 无限制">
                                <small class="form-hint">每月可使用的 Token 数量</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">请求次数限制 (次/日)</label>
                            <input type="number" class="form-input" v-model.number="createUserForm.requestQuota" min="0" placeholder="0 = 无限制">
                            <small class="form-hint">每日可请求的次数，超过后自动禁用</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">频率限制 (次/分钟)</label>
                            <input type="number" class="form-input" v-model.number="createUserForm.rateLimitRPM" min="0" placeholder="0 = 无限制">
                            <small class="form-hint">每分钟最大请求次数，使用滑动窗口限流</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="ri-file-text-line"></i>
                                备注信息
                            </label>
                            <textarea class="form-input" v-model="createUserForm.notes" rows="2" placeholder="添加备注信息（可选）"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="toggle-wrapper">
                                <div>
                                    <div class="toggle-label">启用用户</div>
                                    <small class="form-hint">新建后是否立即启用该用户</small>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" class="toggle-checkbox" v-model="createUserForm.enabled">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="toggle-wrapper">
                                <div>
                                    <div class="toggle-label"><i class="ri-vip-crown-line" style="color: #ffc107;"></i> VIP用户</div>
                                    <small class="form-hint">标记为VIP用户</small>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" class="toggle-checkbox" v-model="createUserForm.isVip">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div v-if="newAPIKey" class="api-key-success">
                        <div class="success-icon">
                            <i class="ri-checkbox-circle-line"></i>
                        </div>
                        <h4>用户创建成功！</h4>
                        <p>请复制保存以下 API Key</p>
                        <div class="api-key-display">
                            <code>{{ newAPIKey }}</code>
                            <button class="btn btn--icon" @click="copyAPIKey(newAPIKey)" data-tooltip="复制">
                                <i class="ri-file-copy-line"></i>
                            </button>
                        </div>
                        <div class="api-key-notice">
                            <i class="ri-error-warning-line"></i>
                            <span>关闭后将无法再次查看完整 API Key，请务必保存</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeCreateUserModal">
                        <i class="ri-close-line"></i> {{ newAPIKey ? '关闭' : '取消' }}
                    </button>
                    <button class="btn btn--primary" @click="confirmCreateUser" v-if="!newAPIKey">
                        <i class="ri-add-line"></i> 创建用户
                    </button>
                </div>
            </div>
        </div>

        <!-- 编辑用户模态框 -->
        <div class="modal-overlay" :class="{active: showEditUserModal}" @click.self="closeEditUserModal">
            <div class="modal user-modal">
                <div class="modal-header">
                    <div class="modal-header-content">
                        <i class="ri-edit-line modal-header-icon"></i>
                        <h3>编辑用户</h3>
                    </div>
                    <button class="modal-close" @click="closeEditUserModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="modal-body" v-if="selectedUser">
                    <div class="user-info-card">
                        <div class="user-info-item">
                            <i class="ri-key-line"></i>
                            <div>
                                <div class="user-info-label">API Key</div>
                                <code class="user-info-value">{{ selectedUser.api_key.substring(0, 24) }}...</code>
                            </div>
                        </div>
                        <div class="user-info-item">
                            <i class="ri-time-line"></i>
                            <div>
                                <div class="user-info-label">创建时间</div>
                                <div class="user-info-value">{{ formatDate(selectedUser.created_at) }}</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="ri-user-line"></i>
                            用户名
                        </label>
                        <input type="text" class="form-input" v-model="editUserForm.name" placeholder="请输入用户名">
                    </div>

                    <div class="form-section-title">
                        <i class="ri-line-chart-line"></i>
                        配额设置
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">日配额 (Token)</label>
                            <input type="number" class="form-input" v-model.number="editUserForm.dailyQuota" min="0" placeholder="0 = 无限制">
                            <small class="form-hint">每日可使用的 Token 数量</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">月配额 (Token)</label>
                            <input type="number" class="form-input" v-model.number="editUserForm.monthlyQuota" min="0" placeholder="0 = 无限制">
                            <small class="form-hint">每月可使用的 Token 数量</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">请求次数限制 (次/日)</label>
                        <input type="number" class="form-input" v-model.number="editUserForm.requestQuota" min="0" placeholder="0 = 无限制">
                        <small class="form-hint">每日可请求的次数，超过后自动禁用</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">频率限制 (次/分钟)</label>
                        <input type="number" class="form-input" v-model.number="editUserForm.rateLimitRPM" min="0" placeholder="0 = 无限制">
                        <small class="form-hint">每分钟最大请求次数，使用滑动窗口限流</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="ri-file-text-line"></i>
                            备注信息
                        </label>
                        <textarea class="form-input" v-model="editUserForm.notes" rows="2" placeholder="添加备注信息（可选）"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="toggle-wrapper">
                            <div>
                                <div class="toggle-label">启用用户</div>
                                <small class="form-hint">禁用后该用户将无法使用 API</small>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" class="toggle-checkbox" v-model="editUserForm.enabled">
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="toggle-wrapper">
                            <div>
                                <div class="toggle-label"><i class="ri-vip-crown-line" style="color: #ffc107;"></i> VIP用户</div>
                                <small class="form-hint">标记为VIP用户</small>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" class="toggle-checkbox" v-model="editUserForm.isVip">
                                <span class="toggle-slider"></span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeEditUserModal">
                        <i class="ri-close-line"></i> 取消
                    </button>
                    <button class="btn btn--primary" @click="confirmEditUser">
                        <i class="ri-save-line"></i> 保存修改
                    </button>
                </div>
            </div>
        </div>

        <!-- 删除用户确认 -->
        <div class="modal-overlay" :class="{active: showDeleteUserModal}" @click.self="closeDeleteUserModal">
            <div class="modal">
                <div class="modal-body" v-if="userToDelete">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: #ffebee;">
                            <i class="ri-delete-bin-line" style="color: var(--color-danger); font-size: 32px;"></i>
                        </div>
                        <div class="logout-text">
                            <h3>确认删除用户</h3>
                            <p>确定要删除用户 "{{ userToDelete.name }}" 吗？此操作无法撤销。</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeDeleteUserModal">取消</button>
                    <button class="btn btn--danger" @click="confirmDeleteUser">删除</button>
                </div>
            </div>
        </div>

        <!-- 重新生成API Key确认 -->
        <div class="modal-overlay" :class="{active: showRegenerateKeyModal}" @click.self="closeRegenerateKeyModal">
            <div class="modal">
                <div class="modal-body" v-if="userToRegenerate">
                    <div class="logout-modal-content">
                        <div class="logout-icon-wrapper" style="background: #fff4e6;">
                            <i class="ri-key-line" style="color: var(--color-warning); font-size: 32px;"></i>
                        </div>
                        <div class="logout-text">
                            <h3>重新生成 API Key</h3>
                            <p>确定要为用户 "{{ userToRegenerate.name }}" 重新生成 API Key 吗？旧的 Key 将立即失效。</p>
                        </div>
                    </div>
                    <div v-if="newAPIKey" class="api-key-display" style="margin-top: 16px;">
                        <code>{{ newAPIKey }}</code>
                        <button class="btn btn--secondary" @click="copyAPIKey(newAPIKey)">
                            <i class="ri-file-copy-line"></i> 复制
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeRegenerateKeyModal">{{ newAPIKey ? '关闭' : '取消' }}</button>
                    <button class="btn btn--primary" @click="confirmRegenerateAPIKey" v-if="!newAPIKey">重新生成</button>
                </div>
            </div>
        </div>

        <!-- 用户统计模态框 -->
        <div class="modal-overlay" :class="{active: showUserStatsModal}" @click.self="closeUserStatsModal">
            <div class="modal modal--large">
                <div class="modal-header">
                    <h3 class="modal-title" v-if="selectedUser">
                        <i class="ri-line-chart-line"></i>
                        {{ selectedUser.name }} - Token使用统计
                    </h3>
                    <button class="modal-close" @click="closeUserStatsModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="modal-body" v-if="userStats" style="max-height: 70vh; overflow-y: auto;">
                    <div class="stats-grid">
                        <div class="stats-card">
                            <div class="stats-card-label">总请求</div>
                            <div class="stats-card-value">{{ userStats.total_requests }}</div>
                        </div>
                        <div class="stats-card stats-card--accent">
                            <div class="stats-card-label">总Token</div>
                            <div class="stats-card-value">{{ formatTokenCount(userStats.total_tokens) }}</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-label">输入</div>
                            <div class="stats-card-value">{{ formatTokenCount(userStats.input_tokens) }}</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-label">输出</div>
                            <div class="stats-card-value">{{ formatTokenCount(userStats.output_tokens) }}</div>
                        </div>
                        <div class="stats-card stats-card--success">
                            <div class="stats-card-label">总消费</div>
                            <div class="stats-card-value">{{ formatCostUSD(userStats.total_cost_usd) }}</div>
                        </div>
                        <div class="stats-card">
                            <div class="stats-card-label">本月消费</div>
                            <div class="stats-card-value">{{ formatCostUSD(userStats.monthly_cost_usd) }}</div>
                        </div>
                    </div>
                    <div v-if="userStats.daily_usage && userStats.daily_usage.length > 0">
                        <h4 style="margin: 20px 0 12px 0; font-size: 14px;">近期使用明细</h4>
                        <table class="usage-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>请求数</th>
                                    <th>输入Token</th>
                                    <th>输出Token</th>
                                    <th>总Token</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="usage in userStats.daily_usage" :key="usage.date">
                                    <td>{{ formatDate(usage.date) }}</td>
                                    <td>{{ usage.request_count }}</td>
                                    <td>{{ formatTokenCount(usage.input_tokens) }}</td>
                                    <td>{{ formatTokenCount(usage.output_tokens) }}</td>
                                    <td><strong>{{ formatTokenCount(usage.total_tokens) }}</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeUserStatsModal">关闭</button>
                </div>
            </div>
        </div>

        <!-- 用户 IP 列表弹窗 @author ygw -->
        <div class="modal-overlay" :class="{active: showUserIPsModal}" @click.self="closeUserIPsModal">
            <div class="modal modal--large">
                <div class="modal-header">
                    <h3 class="modal-title" v-if="selectedUser">
                        <i class="ri-global-line"></i>
                        {{ selectedUser.name }} - 关联 IP 列表
                        <span class="stats-badge" style="margin-left: 8px;">共 {{ userIPs.length }} 个IP</span>
                    </h3>
                    <button class="modal-close" @click="closeUserIPsModal"><i class="ri-close-line"></i></button>
                </div>
                <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                    <div v-if="userIPs.length === 0" class="empty-state">
                        <i class="empty-state-icon ri-global-line"></i>
                        <p>暂无关联 IP 记录</p>
                    </div>
                    <table v-else class="data-table">
                        <thead>
                            <tr>
                                <th>IP 地址</th>
                                <th class="sortable" @click="handleUserIPsSort('request_count')" :class="{'sort-active': userIPsSortField === 'request_count'}" style="cursor: pointer;">
                                    总请求
                                    <i v-if="userIPsSortField === 'request_count'" :class="userIPsSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                </th>
                                <th class="sortable" @click="handleUserIPsSort('request_count_day')" :class="{'sort-active': userIPsSortField === 'request_count_day'}" style="cursor: pointer;">
                                    最近一天
                                    <i v-if="userIPsSortField === 'request_count_day'" :class="userIPsSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                </th>
                                <th class="sortable" @click="handleUserIPsSort('request_count_hour')" :class="{'sort-active': userIPsSortField === 'request_count_hour'}" style="cursor: pointer;">
                                    最近一小时
                                    <i v-if="userIPsSortField === 'request_count_hour'" :class="userIPsSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                </th>
                                <th class="sortable" @click="handleUserIPsSort('success_count')" :class="{'sort-active': userIPsSortField === 'success_count'}" style="cursor: pointer;">
                                    成功请求
                                    <i v-if="userIPsSortField === 'success_count'" :class="userIPsSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                </th>
                                <th class="sortable" @click="handleUserIPsSort('last_visit')" :class="{'sort-active': userIPsSortField === 'last_visit'}" style="cursor: pointer;">
                                    最后访问
                                    <i v-if="userIPsSortField === 'last_visit'" :class="userIPsSortOrder === 'asc' ? 'ri-arrow-up-s-line' : 'ri-arrow-down-s-line'"></i>
                                </th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="ip in sortedUserIPs" :key="ip.ip">
                                <td>
                                    <code class="ip-code">{{ ip.ip }}</code>
                                </td>
                                <td>{{ ip.request_count || 0 }}</td>
                                <td>{{ ip.request_count_day || 0 }}</td>
                                <td>{{ ip.request_count_hour || 0 }}</td>
                                <td>{{ ip.success_count || 0 }}</td>
                                <td>{{ formatIPTime(ip.last_visit) }}</td>
                                <td>
                                    <button class="btn btn--mini" @click="handleIPClick(ip.ip)" data-tooltip="查看日志">
                                        <i class="ri-file-list-3-line"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" @click="closeUserIPsModal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 代理池管理弹窗 -->
    <div class="modal-overlay" :class="{active: showProxyPoolModal}" @click.self="closeProxyPoolModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3><i class="ri-server-line"></i> 代理池管理</h3>
                <button class="modal-close-btn" @click="closeProxyPoolModal">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- 添加代理表单 -->
                <div class="form-group">
                    <label class="form-label">添加新代理</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="form-input" v-model="newProxyUrl" placeholder="http://user-%:pass@proxy:port（% 为 Session 占位符）" style="flex: 1;">
                        <input type="text" class="form-input" v-model="newProxyName" placeholder="名称（可选）" style="width: 120px;">
                        <input type="number" class="form-input" v-model.number="newProxyWeight" placeholder="权重" style="width: 80px;" min="1">
                        <button class="btn btn--primary" @click="handleAddProxy" :disabled="!newProxyUrl">
                            <i class="ri-add-line"></i> 添加
                        </button>
                    </div>
                    <small class="form-hint">URL 中使用 % 作为 Session 占位符，同一账号的请求会使用相同的派生值，确保出口 IP 一致</small>
                </div>
                <!-- 代理列表 -->
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">代理列表 ({{ proxyList.length }} 个)</label>
                    <div v-if="proxyList.length === 0" style="text-align: center; padding: 20px; color: var(--color-text-secondary);">
                        暂无代理，请添加
                    </div>
                    <div v-else style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">状态</th>
                                    <th>名称</th>
                                    <th>URL</th>
                                    <th style="width: 60px;">权重</th>
                                    <th style="width: 100px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="proxy in proxyList" :key="proxy.id">
                                    <td>
                                        <span class="status-dot" :class="proxy.enabled ? 'status-dot--success' : 'status-dot--error'"></span>
                                    </td>
                                    <td>{{ proxy.name || '-' }}</td>
                                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" :title="proxy.url">{{ proxy.url }}</td>
                                    <td>{{ proxy.weight }}</td>
                                    <td>
                                        <button class="btn btn--icon btn--small" @click="handleToggleProxy(proxy)" :title="proxy.enabled ? '禁用' : '启用'">
                                            <i :class="proxy.enabled ? 'ri-pause-line' : 'ri-play-line'"></i>
                                        </button>
                                        <button class="btn btn--icon btn--small btn--danger" @click="handleDeleteProxy(proxy)" title="删除">
                                            <i class="ri-delete-bin-line"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" @click="closeProxyPoolModal">关闭</button>
            </div>
        </div>
    </div>

    <!-- 水印容器 -->
    <div id="watermark-container"></div>

    <!-- 模块化JavaScript -->
    <script type="module" src="/frontend/js/app.js"></script>
</body>
</html>
